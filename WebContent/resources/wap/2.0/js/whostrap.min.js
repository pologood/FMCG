var WHT={};(function($){WHT.Dialog=function(ele,options){this.$ele=$(ele);this.$body=$(document.body);this.options=$.extend(true,{},WHT.Dialog.DEFAULTS,options);this.isShown=false};WHT.Dialog.VERSION="1.0.0";WHT.Dialog.DEFAULTS={dialogtype:"alert",tpldatas:{ctns:{txt_ok:"确定",txt_cancel:"取消",txt_title:"对话框标题",txt_body:"对话框提示内容"},hooks:{wrapperid:"",wrapperclass:""},Ctrls:{tplname:"alert",innermode:false}}};WHT.Dialog.prototype.getDialogTitle=function(){return this.options.text_title};WHT.Dialog.prototype.hide=function(){var this_instance=this;if(!this_instance.isShown){return}this_instance.$ele.hide();this_instance.isShown=false;this_instance.$ele.trigger($.Event("closed:WHT:dialog"))};WHT.Dialog.prototype.show=function(){var this_instance=this;if(this_instance.isShown){return}this_instance.$ele.show();this_instance.isShown=true;this_instance.$ele.trigger($.Event("opened:WHT:dialog"))};WHT.Dialog.prototype.toggle=function(){var this_instance=this;if(this_instance.isShown){this_instance.hide();this_instance.isShown=false}else{this_instance.show();this_instance.isShown=true}};WHT.Dialog.prototype.init=function(){var this_instance=this;this_instance.build()};WHT.Dialog.prototype.build=function(){var this_instance=this;hbsTO.render("dialog",function(t){var htmlcreated=t(this_instance.options.tpldatas);this_instance.$ele.html(htmlcreated);if(!this_instance.options.tpldatas.Ctrls.innermode){this_instance.$ele.attr("id",this_instance.options.tpldatas.hooks.wrapperid);this_instance.$ele.addClass("weui_dialog_"+this_instance.options.tpldatas.Ctrls.tplname).addClass(this_instance.options.tpldatas.hooks.wrapperclass);this_instance.$ele.attr("data-dialogtype",this_instance.options.dialogtype);this_instance.$ele.css({display:"none"})}})};WHT.Alert=function(ele,options){WHT.Dialog.call(this,ele,options);this.options=$.extend(true,{},WHT.Alert.DEFAULTS,options);this.init();this.$ele.on("click.WHT.dialog.alert",'[jhk="ok"]',$.proxy(this.hide,this))};WHT.Alert.prototype=new WHT.Dialog;WHT.Alert.prototype.Constructor=WHT.Alert;WHT.Alert.DEFAULTS={dialogtype:"alert",tpldatas:{ctns:{txt_ok:"alert确定",txt_title:"alert标题",txt_body:"alert提示内容"},hooks:{wrapperid:"",wrapperclass:""},Ctrls:{tplname:"alert",innermode:false}}};WHT.Confirm=function(ele,options){WHT.Dialog.call(this,ele,options);this.options=$.extend(true,{},WHT.Confirm.DEFAULTS,options);this.init();this.$ele.on("click.WHT.dialog.confirm",'[jhk="ok"]',$.proxy(function(){this.$ele.trigger($.Event("determined:WHT:dialog:confirm"));this.hide()},this));this.$ele.on("click.WHT.dialog.confirm",'[jhk="cancel"]',$.proxy(this.hide,this))};WHT.Confirm.prototype=new WHT.Dialog;WHT.Confirm.prototype.Constructor=WHT.Confirm;WHT.Confirm.DEFAULTS={dialogtype:"confirm",tpldatas:{ctns:{txt_ok:"confirm确定",txt_cancel:"confirm取消",txt_title:"confirm提示",txt_body:"confirm提示内容"},hooks:{wrapperid:"",wrapperclass:""},Ctrls:{tplname:"confirm",innermode:false}}};var DialogFactory=function(){};DialogFactory.prototype.dialogclass=WHT.Alert;DialogFactory.prototype.createDialog=function(ele,options){switch(options.dialogtype){case"alert":this.dialogclass=WHT.Alert;break;case"confirm":this.dialogclass=WHT.Confirm;break;default:this.dialogclass=WHT.Dialog}return new this.dialogclass(ele,options)};function Plugin(option){var initial_arguments=arguments;console.log("before init i get the $ element length is");console.log(this.length);if(this.length==0&&this.selector==".NULL"){var soga=this.selector;console.log(soga)}return this.each(function(){var $this=$(this);var data_plugin=$this.data("TH.dialog");if(!data_plugin){if(typeof option==="object"||!option){var instance_DialogFactory=new DialogFactory;data_plugin=instance_DialogFactory.createDialog(this,option);$this.data("TH.dialog",data_plugin)}}else{if(typeof option=="string"){data_plugin[option](Array.prototype.slice.call(initial_arguments,1))}else{$.info("Method "+option+" does not exist on Zepto.dialog")}}})}var old=$.fn.dialog;$.fn.dialog=Plugin;$.fn.dialog.Constructor=DialogFactory;$.fn.dialog.noConflict=function(){$.fn.dialog=old;return this}})(Zepto);(function($){WHT.Tip=function(ele,options){this.$ele=$(ele);this.$body=$(document.body);this.options=$.extend(true,{},WHT.Tip.DEFAULTS,options);this.isShown=false};WHT.Tip.VERSION="1.0.0";WHT.Tip.DEFAULTS={tiptype:"toast",tpldatas:{ctns:{txt:"已完成"},hooks:{wrapperid:"",wrapperclass:""},Ctrls:{tplname:"toast",innermode:false}}};WHT.Tip.prototype.getTipTitle=function(){};WHT.Tip.prototype.hide=function(){var this_instance=this;if(!this_instance.isShown){return}this_instance.$ele.hide();this_instance.isShown=false;this_instance.$ele.trigger($.Event("closed:WHT:tip"))};WHT.Tip.prototype.show=function(){var this_instance=this;if(this_instance.isShown){return}this_instance.$ele.show();this_instance.isShown=true;this_instance.$ele.trigger($.Event("opened:WHT:tip"));setTimeout(function(){this_instance.hide()},2e3)};WHT.Tip.prototype.toggle=function(){var this_instance=this;if(this_instance.isShown){this_instance.hide()}else{this_instance.show()}};WHT.Tip.prototype.init=function(){var this_instance=this;this_instance.build()};WHT.Tip.prototype.build=function(){var this_instance=this;hbsTO.render("tip",function(t){var htmlcreated=t(this_instance.options.tpldatas);this_instance.$ele.html(htmlcreated);if(!this_instance.options.tpldatas.Ctrls.innermode){this_instance.$ele.attr("id",this_instance.options.tpldatas.hooks.wrapperid);this_instance.$ele.addClass("weui_tip_"+this_instance.options.tpldatas.Ctrls.tplname).addClass(this_instance.options.tpldatas.hooks.wrapperclass);this_instance.$ele.attr("data-tiptype",this_instance.options.tiptype);this_instance.$ele.css({display:"none"})}})};WHT.Toast=function(ele,options){WHT.Tip.call(this,ele,options);this.options=$.extend(true,{},WHT.Toast.DEFAULTS,options);this.init()};WHT.Toast.prototype=new WHT.Tip;WHT.Toast.prototype.Constructor=WHT.Toast;WHT.Toast.DEFAULTS={tiptype:"toast",tpldatas:{ctns:{txt:"已完成"},hooks:{wrapperid:"",wrapperclass:""},Ctrls:{tplname:"toast",innermode:false}}};WHT.LoadingToast=function(ele,options){WHT.Tip.call(this,ele,options);this.options=$.extend(true,{},WHT.LoadingToast.DEFAULTS,options);this.init()};WHT.LoadingToast.prototype=new WHT.Tip;WHT.LoadingToast.prototype.Constructor=WHT.LoadingToast;WHT.LoadingToast.DEFAULTS={tiptype:"loadingtoast",tpldatas:{ctns:{txt:"数据加载中"},hooks:{wrapperid:"",wrapperclass:""},Ctrls:{tplname:"loadingtoast",innermode:false}}};var TipFactory=function(){};TipFactory.prototype.tipclass=WHT.Toast;TipFactory.prototype.createTip=function(ele,options){switch(options.tiptype){case"toast":this.tipclass=WHT.Toast;break;case"loadingtoast":this.tipclass=WHT.LoadingToast;break;default:this.tipclass=WHT.Tip}return new this.tipclass(ele,options)};function Plugin(option){var initial_arguments=arguments;console.log("before init i get the $ element length is");console.log(this.length);if(this.length==0&&this.selector==".NULL"){var soga=this.selector;console.log(soga)}return this.each(function(){var $this=$(this);var data_plugin=$this.data("TH.tip");if(!data_plugin){if(typeof option==="object"||!option){var instance_TipFactory=new TipFactory;data_plugin=instance_TipFactory.createTip(this,option);$this.data("TH.tip",data_plugin)}}else{if(typeof option=="string"){data_plugin[option](Array.prototype.slice.call(initial_arguments,1))}else{$.info("Method "+option+" does not exist on Zepto.tip")}}})}var old=$.fn.tip;$.fn.tip=Plugin;$.fn.tip.Constructor=TipFactory;$.fn.tip.noConflict=function(){$.fn.tip=old;return this}})(Zepto);(function($){WHT.PositionScroller=function(ele,options){this.$ele=$(ele);this.$body=$(document.body);this.options=$.extend(true,{},WHT.PositionScroller.DEFAULTS,options);this.isShown=false;this.init();this.$ele.on("click.WHT.positionscroller",$.proxy(this.scrollActionDistributor,this))};WHT.PositionScroller.VERSION="1.0.0";WHT.PositionScroller.DEFAULTS={plugintype:"positionscroller",autohide:false,autohide_threshold:$(window).height(),targetposY:"top",tpldatas:{ctns:{head:'<i class="iconfont">&#xe664;</i>',body:""},hooks:{wrapperid:"",wrapperclass:""},Ctrls:{tplname:"positionscroller",innermode:false}}};WHT.PositionScroller.prototype.applyPositionDetect=function(){var this_instance=this;this_instance.scrolldetector=new ScrollChange({wrap_slter:"."+this_instance.$ele.attr("class").split(" ").join("."),threshold:this_instance.options.autohide_threshold,custom_justBelowThreshold:function(){var this_sd=this;$(this_sd.config.wrap_slter).on("animationend.WHT.positionscroller.anmIn webkitAnimationEnd.WHT.positionscroller.anmIn",function(event){$(this).show().removeClass("anm-in");$(this).off("animationend.WHT.positionscroller.anmIn webkitAnimationEnd.WHT.positionscroller.anmIn");this_sd.statelocked.below=false});setTimeout(function(){$(this_sd.config.wrap_slter).show().addClass("anm-in")},0)},custom_belowThreshold:function(){if($(this.wrap_slter).css("display")=="none"){$(this.wrap_slter).show()}},custom_justOverThreshold:function(){var this_sd=this;$(this_sd.config.wrap_slter).on("animationend.WHT.positionscroller.anmOut webkitAnimationEnd.WHT.positionscroller.anmOut",function(event){$(this).hide().removeClass("anm-out");$(this).off("animationend.WHT.positionscroller.anmOut webkitAnimationEnd.WHT.positionscroller.anmOut");this_sd.statelocked.over=false});setTimeout(function(){$(this_sd.config.wrap_slter).addClass("anm-out")},0)},custom_overThreshold:function(){if($(this.wrap_slter).css("display")=="block"){$(this.wrap_slter).hide()}}});$(window).on("touchmove scroll",$.proxy(this_instance.scrolldetector.movehandler,this_instance.scrolldetector))};WHT.PositionScroller.prototype.getPositionScrollerTitle=function(){};WHT.PositionScroller.prototype.scrollActionDistributor=function(){var this_instance=this;var targetposY=this_instance.options.targetposY;if($.type(targetposY)=="string"){switch(targetposY){case"top":this_instance.scrollToTop();break;case"bottom":break;default:break}}if($.type(targetposY)=="number"){this_instance.scrollToPosition(targetposY)}};WHT.PositionScroller.prototype.easingMoveByStep=function(scopeobj,direction,final_posY){final_posY=final_posY||0;var this_instance=this;var timerframe=null;var scopesum=direction=="up"?-scopeobj.sum:scopeobj.sum;var initialsteplength=scopeobj.n;function moveByStep(steplength){var next_scopesum=0;if(timerframe){cancelAnimationFrame(timerframe)}this_instance.jumpToPosition(scopesum+final_posY);if(scopesum>=0){next_scopesum=scopesum-steplength}else{next_scopesum=scopesum+steplength}steplength=steplength>1?steplength-1:1;if(Math.abs(scopesum)>steplength){scopesum=next_scopesum;timerframe=requestAnimationFrame(function(argument){moveByStep(steplength)})}else{this_instance.jumpToPosition(final_posY)}}moveByStep(initialsteplength)};WHT.PositionScroller.prototype.scrollToTop=function(){var this_instance=this;var view_height=$(window).height();this_instance.easingMoveByStep(maxNumberLessThanAccum(view_height),"down")};WHT.PositionScroller.prototype.scrollToBottom=function(){var this_instance=this;var view_height=$(window).height();var S=$(document).height()-($(window).scrollTop()+$(window).height())};WHT.PositionScroller.prototype.scrollToPosition=function(targetposY){var this_instance=this;var ele_offsetY=targetposY;var doc_scrolltop=$(window).scrollTop();var S=0;if(ele_offsetY>doc_scrolltop){if(ele_offsetY+$(window).height()<=$(document).height()){S=ele_offsetY-doc_scrolltop}else{S=$(document).height()-(doc_scrolltop+$(window).height())}if(S<$(window).height()){this_instance.easingMoveByStep(maxNumberLessThanAccum(S),"up",ele_offsetY)}else{this_instance.jumpToPosition(ele_offsetY-$(window).height());this_instance.easingMoveByStep(maxNumberLessThanAccum($(window).height()),"up",ele_offsetY)}}else{S=doc_scrolltop-ele_offsetY;if(S<$(window).height()){this_instance.easingMoveByStep(maxNumberLessThanAccum(S),"down",ele_offsetY)}else{this_instance.jumpToPosition(ele_offsetY+$(window).height());this_instance.easingMoveByStep(maxNumberLessThanAccum($(window).height()),"down",ele_offsetY)}}};WHT.PositionScroller.prototype.hide=function(){var this_instance=this;if(!this_instance.isShown){return}this_instance.$ele.hide();this_instance.isShown=false;this_instance.$ele.trigger($.Event("closed:WHT:positionscroller"))};WHT.PositionScroller.prototype.show=function(){var this_instance=this;if(this_instance.isShown){return}this_instance.$ele.show();this_instance.isShown=true;this_instance.$ele.trigger($.Event("opened:WHT:positionscroller"))};WHT.PositionScroller.prototype.build=function(){var def=$.Deferred();var this_instance=this;hbsTO.render("positionscroller",function(t){var htmlcreated=t(this_instance.options.tpldatas);this_instance.$ele.html(htmlcreated);if(!this_instance.options.tpldatas.Ctrls.innermode){this_instance.$ele.attr("id",this_instance.options.tpldatas.hooks.wrapperid);this_instance.$ele.addClass("weui_positionscroller").addClass(this_instance.options.tpldatas.hooks.wrapperclass);this_instance.$ele.attr("data-plugintype",this_instance.options.plugintype);this_instance.$ele.css({display:"none"})}def.resolve()});return def.promise()};WHT.PositionScroller.prototype.jumpToPosition=function(posY){$(window).scrollTop(posY)};WHT.PositionScroller.prototype.init=function(){var this_instance=this;$.when(this_instance.build()).done(function(){if(this_instance.options.autohide){this_instance.applyPositionDetect()}this_instance.$ele.trigger($.Event("initialized:WHT:positionscroller"))}).fail(function(){console.log("网络异常")})};var PositionScrollerFactory=function(){};PositionScrollerFactory.prototype.dutyclass=WHT.PositionScroller;PositionScrollerFactory.prototype.createPositionScroller=function(ele,options){switch(options.plugintype){case"SomeSubClassName":this.dutyclass=WHT.SomeSubClass;break;default:this.dutyclass=WHT.PositionScroller}return new this.dutyclass(ele,options)};function Plugin(option){var initial_arguments=arguments;if(this.length==0&&this.selector==".NULL"){return null}return this.each(function(){var $this=$(this);var data_plugin=$this.data("TH.positionscroller");if(!data_plugin){if(typeof option==="object"||!option){var instanceof_factory=new PositionScrollerFactory;data_plugin=instanceof_factory.createPositionScroller(this,option);$this.data("TH.positionscroller",data_plugin)}}else{if(typeof option=="string"){data_plugin[option](Array.prototype.slice.call(initial_arguments,1))}else{$.info("Method "+option+" does not exist on Zepto.positionscroller")}}})}var old=$.fn.positionScroller;$.fn.positionScroller=Plugin;$.fn.positionScroller.Constructor=PositionScrollerFactory;$.fn.positionScroller.noConflict=function(){$.fn.positionScroller=old;return this}})(Zepto);