<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>首页</title>
    
<link rel="stylesheet" href="/debug/style/wap.min.css"/>
<script src="/debug/js/zepto.min.js"></script>
<script src="/debug/js/handlebars.min.js"></script>
<script src="/debug/js/lazyload.min.js"></script>
<script src="/debug/js/iSlider.min.js"></script>
<script src="/debug/js/iSlider.animate.min.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>




</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<script type="text/html" id="tpl_toast">

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-loading weui-icon_toast"></i>
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>

</script>
<script type="text/html" id="tpl_dialog">

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">弹窗标题</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->

</script>
<div class="container" id="container"></div>

<script type="text/html" id="tpl_cart">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-loading weui-icon_toast"></i>
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">弹窗标题</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel">

                <div class="weui-cells_checkbox shopCart" ></div>

                <div class="cart_bar">
                    <ul>
                        <li>
                            <div class=" weui-cells_checkbox" >
                                <label class="weui-check__label" >
                                    <p class="checkboxs" >
                                        <input type="checkbox" class="weui-check" name="checkbox1" id="chkall" >
                                        <i class="weui-icon-checked"></i>
                                    </p>
                                    <p class="all f16">全选</p>
                                </label>
                            </div>
                        </li>
                        <li class="f16">合计:￥<span id="span_sum">0</span></li>
                        <li class="f16"><a href="confirmOrder.html">结算</a></li>
                    </ul>
                </div>

            </div>
        </div>
    </div>
</div>

</script>
<script type="text/html" id="tpl_carts">
{{#if tenants}}
 {{!购物车不为空时加载数据}}
    {{#each tenants}}
        <div class="cart-tenant" data-tenant-id="{{id}}">
            <label class="weui-cell weui-check__label" >
                <div class="weui-cell__hd">
                    <input type="checkbox" class="weui-check parent_check" name="checkbox" data-id="'+i+'">
                    <i class="weui-icon-checked"></i>
                </div>
                <div class="weui-cell__bd">
                    <p class="f14">{{name}}</p>
                </div>
            </label>
            {{#with cartItems}}
            {{#each this}}
            <div class="cart-product weui-cell" data-produt-id="{{id}}">
                <label class="weui-check__label" >
                    <p class="checkboxs">
                        <input type="checkbox" class="weui-check child_check sub'+i+' " name="checkbox" data-id="{{id}}">
                        <i class="weui-icon-checked"></i>
                    </p>
                </label>
                <div class="weui-cell__hd">
                    <img src="{{thumbnail}}" alt="">
                </div>
                <div class="weui-cell__bd">
                    <p class="Ftitle">{{fullName}}</p>
                    <p class="size Ftext">
                        {{#each specification}}
                        <span>{{title}}:<i class="orange">{{name}}</i></span>
                        {{/each}}
                    </p>
                    <p class="price f14"><span>￥{{price}}<i>￥{{marketPrice}}</i></span></p>
                    <div class="actv">

                        <div class="weui_cell_ft" style="width:80%">
                            <a class="vux-number-selector vux-number-selector-sub">-</a>
                            <input class="vux-number-input input-number-int" data-value="'+ item1.marketPrice +'" pattern="[1-100]*" name="listen" value="1" style="width: 40px;">
                            <a class="vux-number-selector vux-number-selector-plus">+</a>
                        </div>

                        <span class="detal" data-del-product="{{id}}"><i class="icon iconfont icon-delete-01"></i></span>
                    </div>
                </div>
            </div>
            {{/each}}
            {{/with}}
        </div>
    {{/each}}

  {{else}}
    {{!购物车为空时}}
    <div class="cartEmpty">
        <i class="icon iconfont icon-s-sc"></i>
        <p>购物车快饿瘪了T.T</p>
        <p style="padding-top: 10px"><a href="index.html" class="weui-btn weui-btn_mini weui-btn_warn">去逛逛</a></p>
    </div>
{{/if}}






</script>


<script src="/debug/js/wap.min.js"></script>



<script type="text/javascript">
    $(function () {
        pageManager.show("cart");

        var td = new cart(function (data) {
            var h = render.fill($("#tpl_carts"),data);
            $(".shopCart").append(h);
            console.log();
        });
        td.list();
        cartobj.init();

    });

    // 购物车基类
    var cartobj = {
        init: function(){
            this.cart_calc();
            this.cart_check();
        },// 计算
        cart_check: function(){
            var obj = this;
            // 全选
            $('#chkall').click(function(){
                if ( this.checked ) {

                    $('.parent_check').prop('checked', true);
                    $('.child_check').prop('checked', true);

                    $('.input-number-int').attr('data-checked', 1);
                } else {

                    $('.parent_check').prop('checked', false);
                    $('.child_check').prop("checked", false);
                    $('.input-number-int').attr('data-checked', 0);

                }
                obj.total_calc();

            });

            // 店铺选择
            $('.parent_check').click(function(){
                var parent_obj = $(this).parent().parent().parent();

                if ( this.checked ) {

                    parent_obj.find('.child_check').each(function(){

                        $(this).prop('checked', true);
                        $(this).parent().parent().find('.input-number-int').attr('data-checked', 1);
                    });
                } else {
                    parent_obj.find('.child_check').each(function(){

                        $(this).prop('checked', false);
                        $(this).parent().parent().find('.input-number-int').attr('data-checked', 0);
                    });
                }

                obj.total_calc();
            });

            // 商品选择
            $('.child_check').click(function(){

                if ( this.checked ) {
                    $(this).parent().parent().find('.input-number-int').attr('data-checked', 1);
                } else {
                    $(this).parent().parent().find('.input-number-int').attr('data-checked', 0);
                }

                obj.total_calc();
            });
        },

        // 加减
        cart_calc: function(){
            var obj = this;
            // 加
            $('.mui-numbox-btn-plus').on('click', function(){

                val = $(this).parent().find('.input-number-int').val();

                val = parseInt(val) + 1;

                $(this).parent().find('.input-number-int').val(val);

                obj.total_calc();
            });
            // 减
            $('.mui-numbox-btn-minus').on('click', function(){
                val = $(this).parent().find('.input-number-int').val();

                val = parseInt(val) - 1;
                if ( val < 1) {
                    val = 1;
                }

                $(this).parent().find('.input-number-int').val(val);

                obj.total_calc();
            });
        },
        // 计算总价
        total_calc: function(){
            var total = 0;
            $('input.input-number-int').each(function(){
                //console.log($(this).attr('data-checked'));

                if ( parseInt($(this).attr('data-checked')) ) {
                    total += parseInt($(this).attr('data-value')) *　parseInt( $(this).val() );
                }
            });
            //console.log(total);
            $('#span_sum').html(total);
            if ( total <= 0 ) {
                //alert('请勾选所需商品');
                return ;
            }
        }
    }
</script>


</body>
</html>

