<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>评价订单</title>
    
<link rel="stylesheet" href="/debug/style/wap.min.css"/>
<script src="/debug/js/zepto.min.js"></script>
<script src="/debug/js/handlebars.min.js"></script>
<script src="/debug/js/lazyload.min.js"></script>
<script src="/debug/js/iSlider.min.js"></script>
<script src="/debug/js/iSlider.animate.min.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>




</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<div class="container" id="container"></div>

<script type="text/html" id="tpl_evaluateorder">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-loading weui-icon_toast"></i>
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">弹窗标题</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel" style="padding-bottom: 10vw;">
                
<!--BEGIN evaluateorder-->
<div class="evaluateorder">
    {{#list orderItems}}
    <div class="weui-cells cl" style="margin-top:0px;">
        <div class="weui-cell" style="">
            <a  href="product_details.html?Id=">
                <img src={{thumbnail}} alt="icon" style="width:80px;margin-right:5px;display:block">
            </a>
            <div class="weui-cell__bd weui-cell_primary" style="height:80px;">
                <p style="font-size:15px;display: -webkit-box;-webkit-line-clamp:2;-webkit-box-orient: vertical;overflow: hidden;
                    ">{{fullName}}
                </p>
                <p style="font-size:15px;color:#E6C99C;margin-top:2px;">
                    {{#each promotions}}
                    <a href="javascript:;" style="width:150px;height:50px;
                    border:1px solid #E6C99C;border-radius:3px;color:#E6C99C">{{name}}</a>
                    {{/each}}
                </p>
                <p style="font-size:10px;color:#A0A0A0;">订单号：{{../sn}}</p>
            </div>
            <div style="text-align:right;height:80px;padding-top:2px;">
                <p>￥{{price}}</p>
                <p>&nbsp;</p>
                <p>x{{quantity}}</p>
            </div>
        </div>
    </div>
    {{/list}}


    <form id="headForm" action="javascript:;" method="post" enctype="multipart/form-data">
        <div class="weui-cells weui-cells_form" style="margin-top:0px;">
            <div class="weui-cell" >
                <div class="weui-cell__bd weui-cell_primary" style="border:1px solid #E8EAE9;">
                    <textarea name="content" class="weui-textarea" placeholder="请输入评论" rows="3" id="textarea" maxlength="200"></textarea>
                    <div class="weui-textarea-counter"><span id="text_length">0</span>/200</div>
                </div>
            </div>
        </div>
    </form>
    <div class="weui-cell">
        <div class="form-item">
            <img src="images/static/showimg.png" id="img1" style="display: block; width: 100px; height: 100px;">
            <form id="dateform" enctype ="multipart/form-data">
                <input type="file" class="upload_img" name="file" id="showimg" style="padding:8vw 0;position: absolute;top:3vw;opacity:0" onchange="getFullPath()">
            </form>
        </div>
    </div>
    <div class="weui-cells" style="margin:0px;">
        <div class="weui-cell" style="height:50px;">
            <div class="weui-cell__bd weui-cell_primary">
                <p>满意度</p>
            </div>
            <div class="weui-cell__ft">
                <div class="wrapper">
                    <ul id="star">
                        <li id="star_li">★</li>
                        <li id="star_li">★</li>
                        <li id="star_li">★</li>
                        <li id="star_li">★</li>
                        <li id="star_li">★</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div style="margin:20px auto;">
        <a href="javascript:;" class="weui-btn weui-btn_warn" style="width:80%;" id="save">确认</a>
    </div>
</div>


<script>
    function getFullPath() {
        var file=document.getElementById('showimg');
        var fileList = file.files;
        var img=document.getElementById("img1");
        for(var i=0;i<fileList.length;i++){
            if(file.files[0]){
                img.style.display = 'block';
                img.style.width = '100px';
                img.style.height = '100px';
                if (window.createObjectURL!=undefined) { // basic
                    img.src = window.createObjectURL(file.files[0]);
                } else if (window.URL!=undefined) { // mozilla(firefox)
                    img.src = window.URL.createObjectURL(file.files[0]);
                } else if (window.webkitURL!=undefined) { // webkit or chrome
                    img.src = window.webkitURL.createObjectURL(file.files[0]);
                }
            }
            var f_i= new FormData();
            f_i.append("file",fileList[i])
        }
    }

</script>
<!--END evaluateorder-->

            </div>
        </div>
    </div>
</div>


</script>


<script src="/debug/js/wap.min.js"></script>


<script type="text/javascript">
    $(function () {
        pageManager.show("evaluateorder");

        //星星评分
        var star = document.getElementById("star");
        var star_li=$("#star").find("li");
        var iStar=0;
        var len = star_li.length;
        var iScore=fnPoint(len);//减去所有的头部和尾部元素，//默认是4分
        var view_type;
        for(var i=1; i<=len; i++){
            star_li[i-1].index = i;
            star_li[i-1].onmouseover = function(){
                fnPoint(this.index);
                // star_li[i].className = "act";
            };
            star_li[i-1].onclick = function(){
                iStar=this.index;
            };
        }
        function fnPoint(iArg){
            iScore = iArg || iStar;
            for (var ii = 0; ii < len; ii++) star_li[ii].className = ii < iScore ? "act" : "";
            return iScore;
        }

        //点击添加评论按钮
        $("#save").on("click",function(){
            if(iScore==1){
                view_type="negative";
            }else if(iScore==2||iScore==3){
                view_type="moderate";
            }else{
                view_type="positive";
            }

            if($("#textarea").val()==""){
                dialog.show("评论内容不能为空")
            }else{
                $.ajax({
                    url:"/wap/member/review/add.jhtml",
                    type:"post",
                    dataType:"json",
                    data:{
                        tradeId:data.data.id,
                        flag:"trade",
                        type:view_type,
                        assistant:iScore,
                        score:iScore,
                        content:$("#textarea").val(),
                        url_list:url_list
                    },
                    traditional: true,
                    success:function(data2){
                        closeWaitLoadingToast();
                        if(data2.message.type=="success"){
                            showToast(data2.message);
                            location.href="/wap/member/order/list.jhtml?type=unreview";
                        }else if(data2.message.type=="error"){
                            showToast2(data2.message);
                        }
                    }
                });
            }
        });


        //上传晒图的照片，接口返回图片地址src
        $("#showimg").change(function () {
            var f2 = new file(function (a) {
                console.log(a)
            });
            f2.uploadImage(new FormData($("#dateform")[0]));
        });


        //检测文本域的字数
        $("#textarea").keyup(function() {
            $("#text_length").text($("#textarea").val().length);
        });


    });


</script>


</body>
</html>