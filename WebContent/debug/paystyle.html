<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>订单付款</title>
    
<link rel="stylesheet" href="/debug/style/wap.min.css"/>
<script src="/debug/js/zepto.min.js"></script>
<script src="/debug/js/handlebars.min.js"></script>
<script src="/debug/js/lazyload.min.js"></script>
<script src="/debug/js/iSlider.min.js"></script>
<script src="/debug/js/iSlider.animate.min.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>




</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<script type="text/html" id="tpl_toast">

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-loading weui-icon_toast"></i>
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>

</script>
<script type="text/html" id="tpl_dialog">

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">弹窗标题</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->

</script>
<div class="container" id="container"></div>

<script type="text/html" id="tpl_paystyle">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-loading weui-icon_toast"></i>
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">弹窗标题</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel"
                
<!--BEGIN paystyle-->
<div class="paystyle">
    <div class="safepay" style="display:block">
        <p class="title f20">订单付款</p>
        <div class="weui-cells">
            <div class="weui-cell">
                <div class="weui-cell__bd weui-cell__primary">
                    <p>付款单号</p>
                </div>
                <div class="weui-cell__ft" style="color:#000" id="sn">
                    2016112557741
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__bd weui-cell__primary">
                    <p>费用详情</p>
                </div>
                <div class="weui-cell__ft" style="color:#000">
                    订单付款
                </div>
            </div>
            <div class="weui-cell">
                <div class="weui-cell__bd weui-cell__primary">
                    <p>付款金额</p>
                </div>
                <div class="weui-cell__ft" style="color:#000">
                    ￥<spna id="payamount">5.00</spna>
                </div>
            </div>
            <div class="accordion">
                <div class="weui-flex  weui-cell_access" >
                    <input type="hidden" name="" value="x09">
                    <p class="weui-flex__item">付款方式</p>
                    <p class="weui-flex__item changestyle" styleid="1">微信支付</p>
                    <span class="weui-cell__ft"></span>
                </div>
                <div class="erji">
                    <div class="weui-cells_radio">
                        <label class="weui-cell weui-check__label" for="x09">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-wechat"></i>
                            </div>
                            <div class="weui-cell__bd weui_cell_primary">
                                <p data-id="1">微信支付</p>
                            </div>
                            <div class="weui-cell__ft">
                                <input type="radio" class="weui-check" name="radio2" id="x09" checked="checked">
                                <span class="weui-icon-checked"></span>
                            </div>
                        </label>
                        <label class="weui-cell weui-check__label" for="x10">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-purse-03"></i>
                            </div>
                            <div class="weui-cell__bd weui_cell_primary">
                                <p data-id="2">余额付款</p>
                            </div>
                            <div class="weui-cell__ft">
                                <input type="radio" name="radio2" class="weui-check" id="x10">
                                <span class="weui-icon-checked"></span>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <a href="javascript:;" id="sendpay" class="weui-btn weui-btn__primary">安全付款</a>
    </div>

    <div class="cashpay" style="margin-top: 50%;">
        <p class="cs">请输入支付密码</p>
        <p>零钱</p>
        <p id="cashmoney">100.00</p>
        <div class="pwd-box">
            <input type="tel" maxlength="6" class="pwd-input" id="pwd-input">
            <div class="fake-box">
                <input type="password" readonly="">
                <input type="password" readonly="">
                <input type="password" readonly="">
                <input type="password" readonly="">
                <input type="password" readonly="">
                <input type="password" readonly="">
            </div>
        </div>
        <p><i class="icon iconfont icon-remove-02"></i></p>
        <p><a href="mypaypassword.html" style="color:red;">忘记密码</a></p>
    </div>
</div>
<!--END paystyle-->

            </div>
        </div>
    </div>


</div>

</script>


<script src="/debug/js/wap.min.js"></script>


<script src="js/jsbn.js"></script>
<script src="js/prng4.js"></script>
<script src="js/rng.js"></script>
<script src="js/rsa.js"></script>
<script src="js/base64.js"></script>

<script type="text/javascript">
    $(function () {
        pageManager.show("paystyle");

        var sn=pageManager.GetQueryString("sn");
        var amount=pageManager.GetQueryString("price");
        $('#sn').html(sn);
        $('#payamount').html(amount);


            //提交后弹开密码框
            $('.paystyle #sendpay').click(function(){
                var payid=$('.safepay').find('.changestyle').attr('styleid');  //支付方式  1是微信支付  2是余额支付
                if(payid==2){    //余额支付
                    $('.paystyle .cashpay').css("display",'block');
                    $(".paystyle #cashmoney").html(amount);   //同步到密码框里面的金额

                    //按钮关闭密码框
                    $(".paystyle .icon-remove-02").click(function(){
                        $('.paystyle .cashpay').css("display",'none');
                    })


                    //密码框js控制
                    var $input = $(".fake-box input");
                    $("#pwd-input").on("input", function() {
                        var pwd = $(this).val().trim();
                        for (var i = 0, len = pwd.length; i < len; i++) {
                            $input.eq("" + i + "").val(pwd[i]);
                        }
                        $input.each(function() {
                            var index = $(this).index();
                            if (index >= len) {
                                $(this).val("");
                            }
                        });
                        if (len == 6) {
                            //密码到达6位数后执行接口
                            bankid=$('#selbank').attr('bankid');   //银行卡id
                            amount=$("#getcash").val();            //提现数额
                            var cm=new common(function (data){
                                console.log(data);
                                var rsaKey = new RSAKey();
                                rsaKey.setPublic(b64tohex(data.modulus), b64tohex(data.exponent));
                                var enPassword = hex2b64(rsaKey.encrypt(pwd));
                                var me=new member(function(data){
                                    toast.show("提现成功");
                                    setTimeout(function () {
                                        location.reload();
                                    },1000);
                                });
                                me.cash({memberBankId:bankid,amount:amount,enPassword:enPassword})
                            });
                            cm.getPublicKey();
                        }
                    });
                }else if(payid==1){    //微信支付




                }

            });






    });


</script>


</body>
</html>


