<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>账单</title>
    
<link rel="stylesheet" href="/debug/style/wap.min.css"/>
<script src="/debug/js/zepto.min.js"></script>
<script src="/debug/js/handlebars.min.js"></script>
<script src="/debug/js/lazyload.min.js"></script>
<script src="/debug/js/iSlider.min.js"></script>
<script src="/debug/js/iSlider.animate.min.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>




</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<script type="text/html" id="tpl_toast">

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-loading weui-icon_toast"></i>
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>

</script>
<script type="text/html" id="tpl_dialog">

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">弹窗标题</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->

</script>
<div class="container" id="container"></div>

<script type="text/html" id="tpl_mybill">
<div class="page user_bill">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-loading weui-icon_toast"></i>
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">弹窗标题</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-flex">
            <div class="weui-flex__item"><div class="placeholder"><p><span id="z1">2016</span>年</p><p><span id="z2">11</span>月</p></div></div>
            <div class="weui-flex__item"><div class="placeholder"><p>支出(元)</p><p id="total_outcome">0.00</p></div></div>
            <div class="weui-flex__item"><div class="placeholder"></div><p>收入(元)</p><p id="total_income">0.00</p></div>
        </div>
        <div class="weui-tab" style="clear:both">
            <div class="weui-navbar">
                <div class="weui-navbar__item active f16" style="color:red;">
                    明细
                </div>
                <div class="weui-navbar__item f16">
                    统计
                </div>
            </div>
            <div class="weui-tab__panel pageable">
                <div class="billdt"></div>
            </div>
            <div class="weui-tab__panel" style="display:none;padding-bottom: 0; background: #e9e9e9;">
                <div class="census">
                    <div class="weui-cells">
                        <div class="weui-cell">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-l-bc-01" style="background:#fa6a05;color:#fff"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>贷款收入<span class="receipts">0</span>%</p>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>+￥<span id="receipts">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-l-bc-01" style="background:#fa6a05;color:#fff"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>分润收入<span class="profit">0</span>%</p>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>+￥<span id="profit">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-l-bc-01" style="background:#fa6a05;color:#fff"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>交易佣金<span class="rebate">0</span>% </p>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>-￥<span id="rebate">0.00</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cells">
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-store-02" style="color:#f86161;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>购物支出<span class="payment">0</span>%</p>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>-￥<span id="payment">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-store-02" style="color:#f86161;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>线下收款<span class="cashier">0</span>%</p>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>+￥<span id="cashier">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-store-02" style="color:#f86161;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>其他支出<span class="outcome">0</span>%</p>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>-￥<span id="outcome">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-store-02" style="color:#f86161;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>其他收入<span class="income">0</span>%</p>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>+￥<span id="income">0.00</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cells">
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-store-02" style="color:#f86161;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>充值收入<span class="recharge">0</span>%</p>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>+￥<span id="recharge">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-store-02" style="color:#f86161;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>提现支出<span class="withdraw">0</span>%</p>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>-￥<span id="withdraw">0.00</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="calender">
            <p>
                <label>年月:</label>
                <select name="" id="x1">
                    <option value="2016">2016</option>
                    <option value="2017">2017</option>
                    <option value="2018">2018</option>
                    <option value="2019">2019</option>
                    <option value="2020">2020</option>
                    <option value="2021">2021</option>
                    <option value="2022">2022</option>
                </select>年
                <select name="" id="x2">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">8</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                </select>月
            </p>
            <p style="text-align:center;"><button>确定</button></p>
        </div>
    </div>
</div>



</script>
<script type="text/html" id="tpl_bills">

<!--账单明细模板-->


{{#each this}}
<div class="weui-cell ">
    <div class="weui-cell__hd f14">
        {{#if type}}
            {{#compare type '==' 'recharge'}}
            <p>充值</p>
            {{/compare}}
            {{#compare type '==' 'payment'}}
            <p>购物</p>
            {{/compare}}
            {{#compare type '==' 'withdraw'}}
            <p>贷款</p>
            {{/compare}}
            {{#compare type '==' 'receipts'}}
            <p>分润</p>
            {{/compare}}
            {{#compare type '==' 'profit'}}
            <p>佣金</p>
            {{/compare}}
            {{#compare type '==' 'rebate'}}
            <p>收款</p>
            {{/compare}}
            {{#compare type '==' 'rebate'}}
            <p>收款</p>
            {{/compare}}
            {{#compare type '==' 'cashier'}}
            <p>其他</p>
            {{/compare}}
            {{#compare type '==' 'income'}}
            <p>其他</p>
            {{/compare}}
            {{#compare type '==' 'outcome'}}
            <p>红包</p>
            {{/compare}}
            {{#compare type '==' 'coupon'}}
            <p>红包</p>
            {{/compare}}
        {{/if}}
    </div>
    <div class="weui-cell__bd weui-cell__primary f12">
        <p>{{memo}}</p>
        <p>{{create_date}}</p>
    </div>
    <div class="weui-cell__ft f12">
        {{#if credit}}
        {{#compare credit '>' 0}}
        <p>+￥{{credit}}</p>
        {{/compare}}
        {{#compare credit '<' 0}}
        <p>-￥{{credit}}</p>
        {{/compare}}
        {{/if}}

        {{#if debit}}
        {{#compare debit '>' 0}}
        <p>-￥{{debit}}</p>
        {{/compare}}
        {{#compare debit '<' 0}}
        <p>-￥{{debit}}</p>
        {{/compare}}
        {{/if}}

        <p>￥{{balance}}</p>
    </div>
</div>
{{/each}}
</script>


<script src="/debug/js/wap.min.js"></script>


<script type="text/javascript">
    $(function () {
        pageManager.show("mybill");

        var pge = $(".pageable").pageable({
                    loadUpFn:function(me) {
                        var tu = new deposit(function (data) {
                            var h = render.fill($("#tpl_bills"),data);
                            $(".pageable .billdt").html(h);
                            pge.resetload();
                        });
                        tu.list({begin_date:'2015-12-12 00:00:00',pageNumber: 1});
                    },
                    loadDownFn :function(me) {
                        var td = new deposit(function (data) {
                            pge.pageNumber = me.pageNumber +1;
                            var h = render.fill($("#tpl_bills"),data);
                            $(".pageable .billdt").append(h);
                            if (data.length<20){
                                pge.lock();
                                pge.noData();
                            }
                            pge.resetload();
                        });
                        td.list({begin_date:'2015-12-12 00:00:00',pageNumber: me.pageNumber});
                    }
                }
        );

        //选项卡切换
        $('.weui-navbar__item').on('click', function () {
            $(this).addClass('active').siblings().removeClass('active');
            $(this).css("color",'red').siblings().css('color','#000');
            $(this).parent().parent().children().eq($(this).index()+1).css("display","block").siblings('.weui-tab__panel').css("display","none")
        });

        //点击出现日期选择框
        $('.user_bill .weui-flex div').eq(0).click(function(){
            $('.user_bill .calender').css("display",'block');
        })

        //选择日期后改变当前日期的值
        $('.user_bill .calender button').click(function(){
            $(".pageable .billdt").html('');
            var z1=$('#x1').val();
            var z2=$('#x2').val();
            $('#z1').html(z1);
            $('#z2').html(z2);
            $('.user_bill .calender').css("display",'none');
            var begin_date=z1+'-'+z2+'-1'+' '+'00:00:00';
            var end_date=z1+'-'+z2+'-31'+' '+'23:59:59';
            var de=new deposit(function(data){
                console.log(data);
                $("#total_income").html(data.total_income);                                        //总收入
                $("#total_outcome").html(data.total_outcome);                                      //总支出
                $("#receipts").html(data.receipts);                                                //贷款收入
                $(".receipts").html(Math.round(data.receipts/data.total_income * 10000)/100.00);   //贷款收入百分比
                $("#profit").html(data.profit);                                                    //分润收入
                $(".profit").html(Math.round(data.profit/data.total_income * 10000)/100.00);       //分润收入百分比
                $("#rebate").html(data.rebate);                                                    //佣金支出
                $(".rebate").html(Math.round(data.rebate/data.total_outcome * 10000)/100.00);      //佣金支出百分比
                $("#payment").html(data.payment);                                                  //购物支出
                $(".payment").html(Math.round(data.payment/data.total_outcome * 10000)/100.00);    //购物支出百分比
                $("#cashier").html(data.cashier);                                                  //收款收入
                $(".cashier").html(Math.round(data.cashier/data.total_income * 10000)/100.00);     //收款收入百分比
                $("#outcome").html(data.outcome);                                                  //其他支出
                $(".outcome").html(Math.round(data.outcome/data.total_outcome * 10000)/100.00);    //其他支出百分比
                $("#income").html(data.income);                                                    //其他收入
                $(".income").html(Math.round(data.income/data.total_income * 10000)/100.00);       //其他收入百分比
                $("#recharge").html(data.recharge);                                                //充值收入
                $(".recharge").html(Math.round(data.recharge/data.total_income * 10000)/100.00);   //充值收入百分比
                $("#withdraw").html(data.withdraw);                                                //提现支出
                $(".withdraw").html(Math.round(data.withdraw/data.total_outcome * 10000)/100.00);  //提现支出百分比
            });
            de.sumer({begin_date:begin_date,end_date:end_date});




            var pge = $(".pageable").pageable({
                        loadUpFn:function(me) {
                            var tu = new deposit(function (data) {
                                var h = render.fill($("#tpl_bills"),data);
                                $(".pageable .billdt").html(h);
                                pge.resetload();
                            });
                            tu.list({begin_date:begin_date,end_date:end_date,pageNumber: 1});
                        },
                        loadDownFn :function(me) {
                            var td = new deposit(function (data) {
                                pge.pageNumber = me.pageNumber +1;
                                var h = render.fill($("#tpl_bills"),data);
                                $(".pageable .billdt").append(h);
                                if (data.length<20){
                                    pge.lock();
                                    pge.noData();
                                }
                                pge.resetload();
                            });
                            td.list({begin_date:begin_date,end_date:end_date,pageNumber: me.pageNumber});
                        }
                    }
            );

        });


    });
</script>


</body>
</html>


