<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>活动</title>
    
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<link rel="stylesheet" href="/weixin/style/wap.min.css"/>
<script src="/weixin/js/zepto.min.js"></script>
<script src="/weixin/js/callbacks.js"></script>
<script src="/weixin/js/deferred.js"></script>
<script src="/weixin/js/handlebars.min.js"></script>
<script src="/weixin/js/lazyload.min.js"></script>
<script src="/weixin/js/iSlider.min.js"></script>
<script src="/weixin/js/iSlider.animate.min.js"></script>
<script src="/weixin/js/fly.min.js"></script>
<script src="/weixin/js/requestAnimationFrame.js"></script>
<script src="/weixin/js/iscroll.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>


  

</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<div class="container" id="container"></div>

<!--活动页-->
<script type="text/html" id="tpl_activityPage">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel pageable" style="padding-bottom: 0;">
                <div id="scroll_top" data-id="scroll_top"></div>
                <div id="act_banner">
                    <img src="../images/placeholder/blank640x380.png" />
                </div>

                <div class="contentAd">

                </div>
                <!--返回顶部-->
                <a data-id="scroll_top" href="javascript:;" class="act_goTop_ft f16">
                    <span class="xian"></span><span>返回顶部</span><span class="xian"></span>
                </a>
                <a data-id="scroll_top" href="javascript:;" class="act_goTop">
                    <img class="lazy" src="http://www.ztbmall.com/resources/wap/3.0/image/act_Top_002.png" width="100%">
                </a>
            </div>
        </div>
    </div>
</div>
<script>
    $(function () {
        var ta = new activity(function (data) {
            var h = render.fill($("#tpl_activityMoban"), data);
            $(".contentAd").html(h);

            if($('#act_nav').find('li').length < 5){
                $('#act_nav').html('').hide();
            }

            $('.marketPricead').each(function () {
               if($(this).html()=='0'){
                   $(this).parent().html('');
               }
            });
        });
        ta.union({linkId: pageManager.GetQueryString("linkId")});

        //顶部广告位
        var ad = new activity(function(data){
            var obj = data.adPosition[0];
            $("#act_banner").find("img").attr("src",obj.image);

            if(data.singleProductPositions.length < 4){
                $('#act_nav').hide();
            }
        });
        ad.union({linkId: pageManager.GetQueryString("linkId")});

        //分享
        var tb = new activity(function (data) {
            console.log(data);
            weixin.share({//微信分享注册
                title: data.share.title,
                desc: data.share.desc,
                link: data.share.link,
                imgUrl: data.share.imgUrl
            });
        });
        tb.union({linkId: pageManager.GetQueryString('linkId')});

    });

</script>
</script>
<!--模版-->
<script type="text/html" id="tpl_activityMoban">


<div id="act_nav">
    <ul>
{{#each singleProductPositions}}
        {{#compare @index '>=' 1}}
        <li>
            <a data-id="act-{{@index}}" class="f14" href="javascript:;">{{name}}</a>
        </li>
        {{/compare}}
{{/each}}
    </ul>
</div>

{{#each singleProductPositions}}
<div data-id="act-{{@index}}" id="act-{{@index}}" class="newYear_act_bd weui_cells">
    {{#compare singleProducts '==' ''}}
    {{/compare}}
    {{#compare singleProducts '!=' ''}}
    <div class="title f14 clr_red"><span>{{name}}</span></div>
    {{/compare}}

    {{#compare @index '==' 0}}
    <div id="newYear_act_pic">
        <ul>
            {{#each singleProducts}}
            <li>
                <a href="../product/product-details.html?id={{id}}">
                    <div class="img">
                        <img class="lazy" src="{{thumbnail}}">
                    </div>
                    <p class="f14">{{name}}</p>
                    <p class="f14 price">
                        <span class="clr_red">￥{{price}}</span>
                        {{#compare marketPrice '!=' price}}
                        <span class="f12">￥<span class="marketPricead">{{marketPrice}}</span></span>
                        {{/compare}}
                        {{#compare marketPrice '==' price}}
                        {{/compare}}
                    </p>
                </a>
            </li>
            {{/each}}
        </ul>
    </div>
    {{/compare}}
    {{#compare @index '!=' 0}}
    {{#each singleProducts}}
    <div class="item">
        <a class="weui_cell" href="../product/product-details.html?id={{id}}">
            <div class="weui_cell_hd">
                <img class="lazy" src="{{thumbnail}}">
            </div>
            <div class="weui_cell_bd">
                <h2 class="f16">
                    <span class="clr_mauve f14">[包邮]</span>
                    {{name}}
                </h2>
                <p class="info f14">{{title}}</p>
                <div class="like f14">
                    <p>
                        <span class="f12">
                            {{hits}}人喜欢
                        </span>
                    </p>
                    <p>
                        <i class="iconfont icon-s-heart-01 f14 clr_red"></i>
                    </p>
                </div>
                <div class="priceT clr_gray">
                    {{#compare marketPrice '!=' price}}
                    <s class="f12 marketPricead">￥<span class="marketPricead">{{marketPrice}}</span></s>
                    {{/compare}}
                    {{#compare marketPrice '==' price}}
                    {{/compare}}
                    <span class="f12"><em class="clr_red">{{monthSales}}</em>件已售</span>
                </div>
                <div class="price clr_red">
                    <em class="f16">￥</em>
                    <span class="f24">{{price}}</span>
                    <span class="weui_cell_ft f14" style="float: right; margin-top:8px;">
                        <span>马上抢</span>
                    </span>
                </div>
            </div>
        </a>

    </div>
    {{/each}}
    {{/compare}}
</div>
{{/each}}
</script>

<script src="/weixin/js/wap.min.js"></script>



<script type="text/javascript">
    $(function () {
        pageManager.show("activityPage");

        /**
         *   在指定时间后调用函数或计算表达式
         *   使用data-id进行页面||导航--跳转-->>相应内容
         */
        var timer = null;
        timer = setInterval(function () {
            [].slice.call(document.querySelectorAll('a')).forEach(function (el) {
                el.addEventListener('click', function () {
                    var target = document.querySelector('div[data-id=' + this.getAttribute('data-id') + ']');
                    target.scrollIntoView(true);
                });
            });
            if (window.onclick) {
                clearInterval(timer);
            }
        }, 30);

        /**
         * 导航栏自动跟随滚动页面内容变化
         */
        var pgea = $(".pageable").pageable({
                    scrollFn: function (me) {
                        $(window).scroll(scrolls);
                        scroll:scrolls();
                        function scrolls(el) {
                            var fNum, actNum, scoll, $this, navHeight;
                            $this = $('#act_nav ul li');
                            navHeight = $("#act_nav").height();
                            for (var i = 0; i < $this.length; i++) {
                                fNum = 'f' + (i + 1);
                                actNum = '#act-' + (i + 1);
                                fNum = $(actNum).offset().top;
                                scoll = 0 - $("#scroll_top").offset().top;
                                //console.log('f' + (i+1) +': ' + (scoll + fNum));
                                //console.log("scoll: "+scoll);
                                if (scoll >= (scoll + fNum) - navHeight) {
                                    $this.eq(i).addClass('active').siblings().removeClass('active');
                                } else {
                                    $this.eq(i).removeClass('active');
                                }
                            }
                            /**
                             *  导航栏及返回顶部显示/隐藏
                             */
                            var top = $("#act_banner").height() + navHeight;
                            if (scoll >= top) {
                                $("#act_nav").addClass("on");
                                $(".act_goTop").css("display", "block");
                            } else {
                                $("#act_nav").removeClass("on");
                                $(".act_goTop").css("display", "none");
                            }
                        }
                    }, loadDownFn: function (me) {
                        $(".pageable .pageable-down").html("").hide();
                    }
                }
        );
    });

</script>

</body>
</html>

