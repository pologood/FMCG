<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
    <title>个人中心</title>
    
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />
<link rel="stylesheet" href="/weixin/style/wap.min.css"/>
<script src="/weixin/js/zepto.min.js"></script>
<script src="/weixin/js/callbacks.js"></script>
<script src="/weixin/js/deferred.js"></script>
<script src="/weixin/js/handlebars.min.js"></script>
<script src="/weixin/js/lazyload.min.js"></script>
<script src="/weixin/js/iSlider.min.js"></script>
<script src="/weixin/js/iSlider.animate.min.js"></script>
<script src="/weixin/js/fly.min.js"></script>
<script src="/weixin/js/requestAnimationFrame.js"></script>
<script src="/weixin/js/iscroll.js"></script>
<script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>


  

</head>
<body ontouchstart>
<div class="weui-toptips weui-toptips_warn js_tooltips">错误提示</div>
<script type="text/html" id="tpl_toast">

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>

</script>
<script type="text/html" id="tpl_dialog">

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->

</script>
<div class="container" id="container"></div>

<!--会员首页-->
<script type="text/html" id="tpl_member-index">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel">
                <!--BEGIN usercenter-->
                <div class="usercenter" page="1">
                    <div class="section" >
                        <div class="weui-cells weui-cells_access">
                            <a class="weui-cell" href="javascript:;">
                                <div class="weui-cell__hd">
                                    <img src="" style="margin-right:5px;display:block;border-radius:50%;" id="headImg">
                                </div>
                                <div class="weui-cell_bd">
                                    <p id="username">用户名</p>
                                    <!--<p><span id="memberRank">vip0</span><span id="authStatus">未认证</span></p>-->
                                </div>
                            </a>

                            <span class="weui-cell__ft"></span>
                        </div>
                        <a href="javascript:pageManager.go('message');">
                           <div class="wrapmes">
                               <i class="icon iconfont icon-chat1"></i>
                               <span class="mesCount"></span>
                           </div>
                        </a>
                    </div>

                    <div class="section1">
                        <ul class="weui-flex" >
                            <li class="weui-flex__item">
                                <a href="../member/coupon.html">
                                    <div class="shop_img"><i class="icon iconfont icon-coupon-01 f22"></i><p class="Ftext">优惠券</p></div>
                                </a>
                            </li>
                            <li class="weui-flex__item">
                                <a href="javascript:pageManager.go('purse-index')">
                                    <div class="shop_img"><i class="icon iconfont icon-wallet-01 f22"></i><p class="Ftext">钱包</p></div>
                                </a>
                            </li>
                            <li class="weui-flex__item">
                                <a href="../member/favorite-tenant.html">
                                    <div class="shop_img"><i class="icon iconfont icon-s-heart-01 f22"></i><p class="Ftext">收藏</p></div>
                                </a>
                            </li>
                        </ul>
                    </div>
                        <div class="section2">
                            <div class="weui-cells" id="all">

                                <a class="weui-cell weui-cell_access" data-type="all" href="member-home.html?type=all#order-list">
                                    <div class="weui-cell__bd ">
                                        <p class="Ftitle ml5" style="margin-left: 5px">我的订单</p>
                                    </div>
                                    <div class="weui-cell__ft f10">
                                        查看全部订单
                                    </div>
                                </a>


                            </div>
                        </div>

                        <div class="section3" id="order">
                            <ul class="weui-flex">
                                <li class="weui-flex__item">
                                    <a  data-type="unpaid" href="member-home.html?type=unpaid#order-list">
                                        <div class="shop_img"><i class="icon iconfont icon-wallet"><span  id="unpaid"></span></i><p class="f10">待付款</p></div>
                                    </a>
                                </li>
                                <li class="weui-flex__item" style="margin-top:-4px">
                                    <a  data-type="unshipped" href="member-home.html?type=unshipped#order-list">
                                        <div class="shop_img"><i class="icon iconfont icon-MIGO" style="font-size:25px;"><span style="right: -12px;top: -5px;" id="unshipped"></span></i><p class="f10" style="margin-top:-5px">待发货</p></div>
                                    </a>
                                </li>
                                <li class="weui-flex__item">
                                    <a  data-type="unreciver" href="member-home.html?type=unreciver#order-list">
                                        <div class="shop_img"><i class="icon iconfont icon-deliver"><span  id="unreciver"></span></i><p class="f10">待收货</p></div>
                                    </a>
                                </li>
                                <li class="weui-flex__item">
                                    <a data-type="unreview" href="member-home.html?type=unreview#order-list">
                                        <div class="shop_img"><i class="icon iconfont icon-comment"><span  id="unreview"></span></i><p class="f10">待评价</p></div>
                                    </a>
                                </li>
                                <li class="weui-flex__item" id="showIOSDialog2">
                                    <a href="javascript:;" class="noopen">
                                        <div class="shop_img" style="margin-top:-2px;"><i class="icon iconfont icon-refund" style="font-size: 22px"></i><p class="f10" style="margin-top: -1px">退货维修</p></div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    <div class="section4">
                        <div class="weui-cells">
                            <!--<a class="weui-cell weui-cell_access" href="javascript:pageManager.go('bound-phone');">-->
                                <!--<div class="weui-cell__hd">-->
                                    <!--<i class="icon iconfont icon-phone f24"></i>-->
                                <!--</div>-->
                                <!--<div class="weui-cell__bd f14">-->
                                    <!--绑定手机-->
                                <!--</div>-->
                                <!--<div class="weui-cell__ft f10" id="bindmobile">-->

                                <!--</div>-->
                            <!--</a>-->
                            <!--<a class="weui-cell weui-cell_access" href="javascript:pageManager.go('promoting-index');">-->
                                <!--<div class="weui-cell__hd">-->
                                    <!--<i class="icon iconfont icon-tuiguang1 f26"></i>-->
                                <!--</div>-->
                                <!--<div class="weui-cell__bd f14">-->
                                    <!--我的推广-->
                                <!--</div>-->
                                <!--<div class="weui-cell__ft">-->
                                <!--</div>-->
                            <!--</a>-->
                            <a class="weui-cell weui-cell_access" href="javascript:pageManager.go('address-list');">
                                <div class="weui-cell__hd">
                                    <i class="icon iconfont icon-dizhi f20"></i>
                                </div>
                                <div class="weui-cell__bd f14">
                                    我的地址
                                </div>
                                <div class="weui-cell__ft">
                                </div>
                            </a>
                        </div>

                        <div class="weui-cells">
                            <!--<a class="weui-cell weui-cell_access" href="javascript:pageManager.go('openshop');">-->
                                <!--<div class="weui-cell__hd">-->
                                    <!--<i class="icon iconfont icon-dian f22"></i>-->
                                <!--</div>-->
                                <!--<div class="weui-cell__bd f14">-->
                                    <!--我要开店-->
                                <!--</div>-->
                                <!--<div class="weui-cell__ft">-->
                                <!--</div>-->
                            <!--</a>-->
                            <a class="weui-cell weui-cell_access" href="javascript:pageManager.go('feedback');">
                                <div class="weui-cell__hd">
                                    <i class="icon iconfont icon-fankui f20"></i>
                                </div>
                                <div class="weui-cell__bd f14">
                                    意见反馈
                                </div>
                                <div class="weui-cell__ft">
                                </div>
                            </a>
                        </div>
                        <div class="weui-cells weui-cell_access">
                            <a class="weui-cell" href="javascript:pageManager.go('about');">
                                <div class="weui-cell__hd">
                                    <i class="icon iconfont icon-guanyuwomen f24"></i>
                                </div>
                                <div class="weui-cell__bd ">
                                    <p class="f14">关于我们</p>
                                </div>
                                <div class="weui-cell__ft">
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
                <!--END usercenter-->
            </div>
        </div>
        

    <div class="weui-tabbar foot_menu" style="position: fixed;">
        <a href="../home/index.html" class="weui-tabbar__item weui-bar__item_on" id="nav1">
            <i class="weui-tabbar__icon iconfont icon-l-home"></i>
            <p class="weui-tabbar__label">首页</p>
        </a>
        <a href="../productCategory/category.html" class="weui-tabbar__item" id="nav2">
            <i class="weui-tabbar__icon iconfont icon-l-classify"></i>
            <p class="weui-tabbar__label">分类</p>
        </a>
        <!--<a href="../nearby/nearby.html" class="weui-tabbar__item" id="nav3">
            <i class="weui-tabbar__icon iconfont icon-l-location"></i>
            <p class="weui-tabbar__label">附近</p>
        </a>-->
        <a href="../carts/cart.html" class="weui-tabbar__item" id="nav4">
            <i class="weui-tabbar__icon iconfont icon-cart"></i>
            <p class="weui-tabbar__label">购物车</p>
        </a>
        <a href="../member/member-home.html" class="weui-tabbar__item " id="nav5">
            <i class="weui-tabbar__icon iconfont icon-l-me"></i>
            <p class="weui-tabbar__label">我的</p>
        </a>
    </div>
    <script type="text/javascript" class="tabbar js_show">
        $(function(){
            var str = window.location.href;
            var index = str .lastIndexOf("\/");
            str  = str .substring(index + 1, str .length);
            if(str=="index.html"){
                $("#nav1").addClass('weui-bar__item_on').siblings('.weui-bar__item_on').removeClass('weui-bar__item_on');
            }
            else if(str=="category.html"){
                $("#nav2").addClass('weui-bar__item_on').siblings('.weui-bar__item_on').removeClass('weui-bar__item_on');
            }
            else if(str.indexOf('nearby.html')!=-1){
                $("#nav3").addClass('weui-bar__item_on').siblings('.weui-bar__item_on').removeClass('weui-bar__item_on');
            }
            else if(str=="cart.html"){
                $("#nav4").addClass('weui-bar__item_on').siblings('.weui-bar__item_on').removeClass('weui-bar__item_on');
            }
            else if(str=="member-home.html" || str=="redPacket.html"){
                $("#nav5").addClass('weui-bar__item_on').siblings('.weui-bar__item_on').removeClass('weui-bar__item_on');

            }
        });
    </script>

    </div>
</div>

<script>
    $(function(){

        //注册分享
        new member(function (data) {
            weixin.share({
                link:data.link
            })
        }).share();

        //退货维修功能操作提
        $('body').on("click", "#order .weui-flex__item .noopen", function () {
            dialog.show("该功能目前暂未开通！")
        });


        //判断右上角是否有未读消息
        var co=new message(function (data) {
            console.log(data);
            if(data.order+data.account+data.message!=0){
                $('.mesCount').html('·');
            };

        });
        co.count();

       //数据处理
            //会员中心头像、用户名、等级、认证状态
            var mem = new member(function (data) {
                $("#username").html(data.username);
                $("#headImg").attr('src',data.headImg);
                $('#memberRank').html(data.memberRank);
                if(data.authStatus=='success'){
                    $('#authStatus').html("已认证");
                    $('#authStatus').css("background","red")
                }else{
                    $('#authStatus').html("未认证");
                };
                //个人中心判断
                console.log($('#username').html()+111)
                //订单列表角标如果是0的话就不显示
                if(data.unpaid==0){
                    $("#unpaid").css("display",'none');
                }else{
                    $("#unpaid").css("display",'block');
                    $("#unpaid").html(data.unpaid);
                    $("#unpaid").addClass('badge');

                }
                if(data.unshipped==0){
                    $("#unshipped").css("display",'none');
                }else{
                    $("#unshipped").css("display",'block');
                    $("#unshipped").html(data.unshipped);
                    $("#unshipped").addClass('badge');
                }
                if(data.unreciver==0){
                    $("#unreciver").css("display",'none');
                }else{
                    $("#unreciver").css("display",'block');
                    $("#unreciver").html(data.unreciver);
                    $("#unreciver").addClass('badge');

                }
                if(data.unreview==0){
                    $("#unreview").css("display",'none');
                }else{
                    $("#unreview").css("display",'block');
                    $("#unreview").html(data.unreview);
                    $("#unreview").addClass('badge');

                }
            });
            mem.index();

            var mm=new member(function (data) {
                console.log(data.bindMobile);
                if(data.bindMobile=='binded'){
                    $('#bindmobile').html('已绑定');
                }else{
                    $('#bindmobile').html('未绑定');
                }
            });
            mm.view();
    })
</script>
</script>

<!--个人信息设置-->
<script type="text/html" id="tpl_set-info">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel" style="padding-bottom:0">

                <!--BEGIN persondata-->
                <div class="persondata">
                    <div class="weui-cells weui-cells——_access section1">
                        <a class="weui-cell" href="javascript:;">
                            <div class="weui-cell__bd weui-cell__mary f14">
                                <p>头像</p>
                            </div>
                            <div class="weui-cell__ft">
                                <div class="item-charter-wrap">
                                    <div class="form-item">
                                        <div style="float:right;" id="background">
                                            <img src="" id="img1" style="display: block;">
                                        </div>
                                        <form id="dateform" enctype ="multipart/form-data">
                                            <input type="file" class="upload_img" name="file" id="myimg" style="padding:8vw 0;position: absolute;top:3vw;opacity:0" onchange="getFullPath()">
                                        </form>
                                        <i class="i-status"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="weui-cell__ft">
                                <i class="icon iconfont"></i>
                            </div>
                        </a>
                    </div>

                    <div class="weui-cells weui-cells——_access section2">
                        <a class="weui-cell borders" href="javascript:;" id="showIOSActionSheet2">
                            <div class="weui-cell__bd weui-cell__mary f14">
                                <p>姓名</p>
                            </div>
                            <div class="weui-cell__ft f14" id="username">--</div>
                            <div class="weui-cell__ft">
                                <i class="icon iconfont"></i>
                            </div>
                        </a>
                        <div class="accordion">
                            <div class="weui-flex  weui-cell_access" >
                                <input type="hidden" name="" value="x09">
                                <p class="weui-flex__item f14">性别</p>
                                <p class="weui-flex__item changestyle f14" id="usersex">女</p>
                                <span class="weui-cell__ft"></span>
                            </div>

                            <div class="erji">
                                <div class="weui-cells_radio">
                                    <label class="weui-cell weui-check__label" for="x09">
                                        <div class="weui-cell__bd weui_cell_primary">
                                            <p data-id="0">男</p>
                                        </div>
                                        <div class="weui-cell__ft">
                                            <input type="radio" class="weui-check" name="radio2" id="x09" checked="checked">
                                            <span class="weui-icon-checked"></span>
                                        </div>
                                    </label>
                                    <label class="weui-cell weui-check__label" for="x10">
                                        <div class="weui-cell__bd weui_cell_primary">
                                            <p data-id="1">女</p>
                                        </div>
                                        <div class="weui-cell__ft">
                                            <input type="radio" name="radio2" class="weui-check" id="x10">
                                            <span class="weui-icon-checked"></span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>



                    <div class="weui-cells weui-cells——_access section3">

                        <a class="weui-cell" href="javascript:pageManager.go('myloginpassword');">
                            <div class="weui-cell__bd weui-cell__mary f14">
                                <p>登录密码</p>
                            </div>
                            <div class="weui-cell__ft orange f14" id="resetlogin">重置密码</div>
                            <div class="weui-cell__ft">
                                <i class="icon iconfont"></i>
                            </div>
                        </a>
                        <a class="weui-cell" href="../payment/paypassword.html">
                            <div class="weui-cell__bd weui-cell__mary f14">
                                <p>支付密码</p>
                            </div>
                            <div class="weui-cell__ft f14 orange" id="resetpay">重置密码</div>
                            <div class="weui-cell__ft">
                                <i class="icon iconfont"></i>
                            </div>
                        </a>
                    </div>

                    <div class="saoma">
                        <div class="lineone">
                            <div class="uphoto"><img src="" alt="" id="img2" style="width:25vw;height:25vw"></div>
                            <span id="username2" class="f14">用户姓名</span>
                            <i class="icon iconfont icon-remove-02"></i>
                        </div>
                        <div class="erwei">
                            <img src="http://dev.ruishangquan.com/weixin/member/qrcode.jhtml" alt="" id="myewm">
                        </div>
                        <p class="f14 tc">扫一扫，关注我</p>
                    </div>

                    <div class="persondata_name f14">
                        <div class="titles"><span class="fl">修改你的姓名</span><span class="fr"> <i class="icon iconfont icon-remove-02"></i></span></div>
                        <div class="p20">
                            <input type="text" placeholder="请输入修改后的姓名">

                            <button type="button">确认修改</button>
                        </div>
                    </div>
                    <div class="weui-mask" id="iosMask2" style="display: none"></div>
                </div>
                <!--END persondata-->
            </div>
        </div>
    </div>
</div>

<script>
    //预览头像
    function getFullPath() {
        var file=document.getElementById('myimg');
        var fileList = file.files;
        var img=document.getElementById("img1");
        for(var i=0;i<fileList.length;i++){
            if(file.files[0]){
                img.style.display = 'block';
                img.style.width = '10vw';
                img.style.height = '10vw';
                if (window.createObjectURL!=undefined) { // basic
                    img.src = window.createObjectURL(file.files[0]);
                } else if (window.URL!=undefined) { // mozilla(firefox)
                    img.src = window.URL.createObjectURL(file.files[0]);
                } else if (window.webkitURL!=undefined) { // webkit or chrome
                    img.src = window.webkitURL.createObjectURL(file.files[0]);
                }
            }
            var f_i= new FormData();
            f_i.append("file",fileList[i])
        }
    }

    //调取数据
    $(function () {

        document.title='我的资料';

        //显示会员基本信息
        var mem1=new member(function(data){
            $("#username").html(data.name);
            $("#username2").html(data.name);   //二维码界面姓名
            $("#nickname").html(data.nickName);
            $("#img1").attr('src',data.headImg); //二维码界面头像
            $("#img2").attr('src',data.headImg);
            if(data.gender=="female"){
                $("#usersex").html("女");
            }else{
                $("#usersex").html("男");
            };
            if(data.authStatus=='success'){
                $('#spread').html("已认证");
                $('.ifspread').removeAttr("href");


            }else if(data.authStatus=='wait'){
                $('.ifspread').removeAttr("href");
                $('#spread').html("认证中");
            }else{
                $('#spread').html("未认证");

            }
            $("#certi").click(function(){
                if(data.authStatus=='success'){
                    $('#spread').html("已认证");
                    $('.ifspread').removeAttr("href");
                    toast.show("您已经实名认证");
                }else if(data.authStatus=='wait'){
                    $('.ifspread').removeAttr("href");
                    $('#spread').html("认证中");
                    toast.show("正在审核，请耐心等待");
                }else{
                    $('#spread').html("未认证");

                }
            });
        });
        mem1.view();



        //上传头像，接口返回图片地址src
        $("#myimg").on('change',function () {
            var f2 = new file(function (a) {
                //修改头像
                var mem=new member(function(data){
                    console.log(data);
                    dialog.show("修改成功");
                });
                mem.update({headImg:a});   //头像的地址设为刚上传的图片
            });
            f2.uploadImage(new FormData($("#dateform")[0]));
        });


        var $iosMask2 = $('#iosMask2');
        function hideActionSheet2(){
            $iosMask2.fadeOut(200);
            $(".saoma").css("display","none");
            $(".persondata_name").css("display","none");
        }
        $iosMask2.on('click', hideActionSheet2);


        //修改姓名
        //打开修改姓名窗口
        $(".section2 a").eq(0).click(function(){
            if($('#spread').html()=='已认证'){
                toast.show('已实名认证，不可修改姓名')
            }else{
                $iosMask2.fadeIn(200);
                $(".persondata_name").css("display","block");
            }
        });
        //进行姓名修改

        $(".persondata_name button").click(function(){
            var newname=$(".persondata_name input").val();
            if(newname==""){
                toast.show("请输入新的姓名！")
            }else{
                $(".section2 #username").html($(".persondata_name input").val());
                $(this).parent().parent().css("display","none");
                $iosMask2.fadeOut(200);
                var mem2=new member(function(data){
                    console.log(data);
                    toast.show("修改成功");
                });
                mem2.update({name:newname});
            }
        });

        //关闭姓名修改
        $(".persondata_name .icon-remove-02").on('click',function(){
            $(".persondata_name").css("display","none");
        })



        //进行性别修改
        $(".persondata .accordion label").click(function(){
            $(".section2 #usersex").html($(this).find('p').html());
            var sex=$(this).find('p').attr('data-id');
            var mem3=new member(function(data){
                console.log(data);
                toast.show("修改成功");
            });
            mem3.update({sex:sex})
        });


        //查看二维码
        $('.persondata .showma').click(function(){
            $iosMask2.fadeIn(200);
            $(".saoma").css("display","block");
        });

        //关闭二维码窗口
        $(".persondata .icon-remove-02").click(function(){
            $(".saoma").css("display","none");
            $iosMask2.fadeOut(200);
        });


    });


</script>
</script>
<script type="text/html" id="tpl_myloginpassword">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel">
                <!--BEGIN setloginpassword-->
                <div class="setloginpassword">
                    <div class="weui-cells weui-cells_form">
                        <div class="weui-cell weui-code">
                            <div class="weui-cell__hd f14"><label class="weui-label">验证码</label></div>
                            <div class="weui-cell__bd weui-cell_primary f14">
                                <input class="weui-input" type="number" placeholder="请输入验证码" id="captcha">
                            </div>
                            <div class="weui-cell_ft">
                                <input type="button" id="send" class="weui-btn weui-btn__primary" style="background:#00a0e9;font-size: 12px;" onclick="settime(this)" value="发送验证码">
                            </div>
                        </div>
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">新密码</label></div>
                            <div class="weui-cell__bd weui-cell_primary f14">
                                <input class="weui-input newPass" type="password" placeholder="请输入新密码">
                            </div>
                        </div>
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">确认密码</label></div>
                            <div class="weui-cell__bd weui-cell_primary f14">
                                <input class="weui-input connewPass" type="password" placeholder="请输入确认密码">
                            </div>
                        </div>
                    </div>
                    <div class="weui-btn-area">
                        <a href="javascript:;" id="sendlogin" class="weui-btn btn-default" style="border-radius: 5px">提交</a>
                    </div>
                </div>
                <!--END setloginpassword-->
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

    //发送验证码后60s倒计时功能
    var countdown=60;
    function settime(val) {
        if (countdown == 0) {
            val.removeAttribute("disabled");
            val.value="发送验证码";
            val.style.background="#00a0e9";
            countdown=60;
            return;
        } else {
            val.setAttribute("disabled", true);
            val.value="重新发送(" + countdown + ")";
            val.style.background="#999";
            countdown--;
        }
        setTimeout(function() {
            settime(val)
        },1000)
    };

//数据处理
    $(function(){
        document.title='重置登录密码';

        //点击发送验证码
        $('#send').click(function(){
            var me=new member(function(data){
                console.log(data);
                toast.show("已发送")
            }) ;
            me.sendMobile();
        });

        $("#sendlogin").click(function(){
            var captcha=$("#captcha").val();
            var newPass=$(".newPass").val();
            var connewPass = $(".connewPass").val();
            //对密码加密
            if(captcha==""){
                toast.show("请输入验证码")
            }else if (newPass != connewPass) {           //判断两次密码是否一样是的话执行修改，否则弹出密码不一致
                toast.show("两次密码不一致");
            }else{
                var cm=new common(function (data) {
                    console.log(data);
                    var rsaKey = new RSAKey();
                    rsaKey.setPublic(b64tohex(data.modulus), b64tohex(data.exponent));
                    var enPassword = hex2b64(rsaKey.encrypt(newPass));
                        var me = new member(function (data) {
                            console.log(data);
                            toast.show("修改成功");
                            setTimeout(function () {
                                window.location.href = document.referrer;
                            }, 1000);
                        });
                        me.retrievePassword({captcha: captcha, newPass: enPassword});
                });
                cm.getPublicKey();
            }
        });

    });

</script>
</script>
<script type="text/html" id="tpl_authentication">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-loading weui-icon_toast"></i>
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">弹窗标题</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <!--BEGIN certification-->
            <div class="certification">
                <div class="weui-cells weui-cells_form">
                    <div class="weui-cell">

                        <div class="weui-cell__hd f14"><label class="weui-label">姓名</label></div>
                        <div class="weui-cell__bd weui-cell_primary f14">
                            <input class="weui-input" type="text" placeholder="真实姓名" id="name">
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd f14"><label class="weui-label">身份证</label></div>
                        <div class="weui-cell__bd weui-cell_primary f14">
                            <input class="weui-input" type="tel" placeholder="请输入15或18位身份证号码" id="idcard">
                        </div>
                    </div>
                </div>
                <p class="f12" style="padding-top: 10vw">点击图片上传身份证正面照</p>
                <div class="weui-cells">
                    <div class="weui-cell weui-cell_warn">
                        <div class="weui-cell">
                            <div class="weui-cell__hd">
                                <div class="item-charter-wrap">
                                    <div class="form-item">
                                        <img src="../images/static/sfz1.png" id="img1" style="display: block; width: 112px; height: 80px;">
                                        <form id="idform1" enctype ="multipart/form-data">
                                            <input type="file" class="upload_img" name="file" id="idcard1" style="padding:8vw 0;position: absolute;top:3vw;opacity:0" onchange="getFullPath()">
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="weui-cell__bd f12">
                                <p>1.要求全部信息无遮挡</p>
                                <p>2.证件上文字清晰可识别</p>
                            </div>
                        </div>
                    </div>
                </div>
                <p class="f12">点击图片上传身份证反面照</p>
                <div class="weui-cells">
                    <div class="weui-cell weui-cell_warn">
                        <div class="weui-cell">
                            <div class="weui-cell__hd">
                                <div class="item-charter-wrap">
                                    <div class="form-item">
                                        <img src="../images/static/sfz2.png" id="img2" style="display: block; width: 112px; height: 80px;">
                                        <form id="idform2" enctype ="multipart/form-data">
                                            <input type="file" class="upload_img" name="file" id="idcard2" style="padding:8vw 0;position: absolute;top:3vw;opacity:0" onchange="getFullPath2()">
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="weui-cell__bd f12">
                                <p>1.要求全部信息无遮挡</p>
                                <p>2.证件上文字清晰可识别</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="my_btn">
                    <div class="weui-btn-area">
                        <a class="weui-btn btn-default" href="javascript:" style="background: #dc1d29" id="sendcerti">提交</a>
                    </div>
                </div>
            </div>
            <!--END certification-->
        </div>
    </div>

</div>

<script type="text/javascript">
    $(function () {
        document.title='实名认证';
        var img1src;
        var img2src;
        $("#idcard1").on('change',function () {
            var fl = new file(function (data) {
                img1src=data;
            });
            fl.uploadImage(new FormData($("#idform1")[0]));
        });

        $("#idcard2").on('change',function () {
            var fl = new file(function (data) {
                img2src=data;
            });
            fl.uploadImage(new FormData($("#idform2")[0]));
        });


        $("#sendcerti").on('click',function () {
            var name=$("#name").val();
            var idcard=$("#idcard").val();
            if(name==''){
                toast.show('请输入姓名');
            }else if(idcard==''){
                toast.show('请输入身份证号');
            }else{
                var me=new member(function(data){
                    console.log(data);
                    dialog.show('提交成功，请耐心等待！');
                    setTimeout(function () {
                        pageManager.back('set-info');
                    },1000);
                });
                me.realNameAuthen({name:name,idcard:idcard,pathFront:img1src,pathBack:img2src});
            }

        })

    });


    //正面图片预览方法
    function getFullPath() {
        var file=document.getElementById('idcard1');
        var fileList = file.files;
        var img=document.getElementById("img1");
        for(var i=0;i<fileList.length;i++){
            if(file.files[0]){
                img.style.display = 'block';
                img.style.width = '112px';
                img.style.height = '80px';
                if (window.createObjectURL!=undefined) { // basic
                    img.src = window.createObjectURL(file.files[0]);
                } else if (window.URL!=undefined) { // mozilla(firefox)
                    img.src = window.URL.createObjectURL(file.files[0]);
                } else if (window.webkitURL!=undefined) { // webkit or chrome
                    img.src = window.webkitURL.createObjectURL(file.files[0]);
                }
            }
            var f_i= new FormData();
            f_i.append("file",fileList[i])
        }
    }

    //反面图片预览方法
    function getFullPath2() {
        var file=document.getElementById('idcard2');
        var fileList = file.files;
        var img=document.getElementById("img2");
        for(var i=0;i<fileList.length;i++){
            if(file.files[0]){
                img.style.display = 'block';
                img.style.width = '112px';
                img.style.height = '80px';
                if (window.createObjectURL!=undefined) { // basic
                    img.src = window.createObjectURL(file.files[0]);
                } else if (window.URL!=undefined) { // mozilla(firefox)
                    img.src = window.URL.createObjectURL(file.files[0]);
                } else if (window.webkitURL!=undefined) { // webkit or chrome
                    img.src = window.webkitURL.createObjectURL(file.files[0]);
                }
            }
            var f_i= new FormData();
            f_i.append("file",fileList[i])
        }
    }
</script>

</script>

<!--消息-->
<script type="text/html" id="tpl_message">
<div class="page">
    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel">
                <!--BEGIN user_message-->
                <div class="user_message" page="1">
                    <div class="weui-cells" style="margin-top: 0">
                        <a class="weui-cell weui-cell_access" href="javascript:pageManager.go('ordermes');">
                            <div class="weui-cell__hd message"><i class="icon iconfont icon-xiaoxizhongxindingdanzhuangtaixinxi"></i><span class="badge countorder"></span></div>
                            <div class="weui-cell__bd">
                                <p class="f12">订单消息</p>
                                <p class="f10 firstodmes"></p>
                            </div>
                        </a>
                        <a class="weui-cell weui-cell_access" href="javascript:pageManager.go('billmes');">
                            <div class="weui-cell__hd message"><i class="icon iconfont icon-zhangdan"></i><span class="badge countbill"></span></div>
                            <div class="weui-cell__bd">
                                <p class="f12">账单消息</p>
                                <p class="f10 firstblmes"></p>
                            </div>
                        </a>
                        <a class="weui-cell weui-cell_access" href="javascript:pageManager.go('sysmes');">
                            <div class="weui-cell__hd message"><i class="icon iconfont icon-xitongxiaoxi"></i><span class="badge countsys"></span></div>
                            <div class="weui-cell__bd">
                                <p class="f12">系统消息</p>
                                <p class="f10 firstsymes"></p>
                            </div>
                        </a>
                    </div>
                    <div class="weui-cells chatlist" style="margin-top: 0">
                        <!--<a class="weui-cell weui-cell_access" href="../product/product-details.html?#chat-guide">-->
                            <!--<div class="weui-cell__hd message">-->
                                <!--<i class="icon iconfont icon-s-circle"></i>-->
                            <!--</div>-->
                            <!--<div class="weui-cell__bd">-->
                                <!--<p class="f12">导购名字</p>-->
                                <!--<p class="f10 gray">最后一句消息最后一句消息最后一句消息最后一句消息</p>-->
                            <!--</div>-->
                        <!--</a>-->
                    </div>
                </div>
                <!--END user_message-->
            </div>
        </div>
    </div>
</div>
<script>
    $(function () {
        document.title='消息';
        //典型消息显示第一个
        var m=new message(function (data) {
            $(".firstodmes").html(data[0].content);
        });
        m.list({type:"order"});

        var me=new message(function (data) {
            $(".firstblmes").html(data[0].content);
        });
        me.list({type:"account"});

        var ms=new message(function (data) {
            $(".firstsymes").html(data[0].content);
        });
        ms.list({type:"message"});

        var co=new message(function (data) {
            console.log(data);
            if(data.order!=0){
                $('.countorder').html('·');
            };
            if(data.account!=0){
                $('.countbill').html('·');
            };
            if(data.message!=0){
                $('.countsys').html('·');
            };
        });
        co.count();


        function getCurrentDb() {
            //打开数据库，或者直接连接数据库参数：数据库名称，版本，概述，大小
            //如果数据库不存在那么创建之
            var db = openDatabase("ch515at", "1.0", "it's to save chatGuide data!", 1024 * 1024); ;
            return db;
        }

        //显示所有数据库中的数据到页面上去
        function showAllTheData() {
            $("#inHtml").empty();
            var db = getCurrentDb();
            db.transaction(function (trans) {
                var nowGuideid=pageManager.GetQueryString('id');
                //查询当前id的导购表的聊天内容
                trans.executeSql("select gid,MAX(mestime),mescont from chatGuide group by gid ", [], function (ts, data) {
                    if (data) {
                        console.log(data);
                        for (var i = 0; i < data.rows.length; i++) {
                            appendDataToTable(data.rows.item(i));//获取某行数据的json对象
                        }
                    }
                }, function (ts, message) {
//                alert(message);
                    var tst = message;});
            });
        }

        var guidename;
        function appendDataToTable(data) {//将数据展示到表格里
            console.log(data);
            //idGuide,mType,mCount,mTime
            var idGuide=data.gid;
            var mType = data.mestype;
            var mCount = data.mescont;
            var mTime = data.mestime;
            var tType=data.txttype;

            new member(function (bb) {
                console.log(bb.nickName);
                guidename=bb.nickName;
                var lhtml='';
                lhtml+= '<a class="weui-cell weui-cell_access" href="../product/product-details.html?id='+idGuide+'#chat-guide">'+
                        '<div class="weui-cell__hd message">'+
                        '<i class="icon iconfont icon-s-circle"></i>'+
                        '</div>'+
                        '<div class="weui-cell__bd">'+
                        '<p class="f12">'+guidename+'</p>'+
                        '<p class="f10 gray">'+mCount+'</p>'+
                        '</div>'+
                        '</a>';
                $('.chatlist').append(lhtml);
            }).view({
                id: idGuide
            });

        }
        showAllTheData();


    })
</script>

</script>
<script type="text/html" id="tpl_ordermes">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel pageable" style="padding-bottom: 10vw;">
                <!--BEGIN orderMessage-->
                <div class="orderMessage ordermes">
                </div>
                <!--END orderMessage-->
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        document.title='订单消息';
        var pge = $(".pageable").pageable({
                    loadUpFn:function(me) {
                        var tu = new message(function (data) {
                            var h = render.fill($("#tpl_orderMessage"),data);
                            $(".pageable .ordermes").html(h);
                            pge.resetload();
                        });
                        tu.list({type:"order",pageNumber: 1});
                    },
                    loadDownFn :function(me) {
                        var td = new message(function (data) {
                            pge.pageNumber = me.pageNumber +1;
                            var h = render.fill($("#tpl_orderMessage"),data);
                            $(".pageable .ordermes").append(h);
                            if (data.length<20){
                                pge.lock();
                                pge.noData();
                            }
                            pge.resetload();
                        });
                        td.list({type:"order",pageNumber: me.pageNumber});
                    }
                }
        );

    })
</script>
</script>
<script type="text/html" id="tpl_billmes">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel pageable" style="padding-bottom: 10vw;">
                <!--BEGIN orderMessage-->
                <div class="orderMessage billes">
                </div>
                <!--END orderMessage-->
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        document.title='账单消息';
        var pge = $(".pageable").pageable({
                    loadUpFn:function(me) {
                        var tu = new message(function (data) {
                            var h = render.fill($("#tpl_billMessage"),data);
                            $(".pageable .billes").html(h);
                            pge.resetload();
                        });
                        tu.list({type:"account",pageNumber: 1});
                    },
                    loadDownFn :function(me) {
                        var td = new message(function (data) {
                            pge.pageNumber = me.pageNumber +1;
                            var h = render.fill($("#tpl_billMessage"),data);
                            $(".pageable .billes").append(h);
                            if (data.length<20){
                                pge.lock();
                                pge.noData();
                            }
                            pge.resetload();
                        });
                        td.list({type:"account",pageNumber: me.pageNumber});
                    }
                }
        );

    })
</script>
</script>
<script type="text/html" id="tpl_sysmes">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel pageable" style="padding-bottom: 10vw;">
                <!--BEGIN orderMessage-->
                <div class="orderMessage symes">
                </div>
                <!--END orderMessage-->
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        document.title='系统消息';
        var pge = $(".pageable").pageable({
                    loadUpFn:function(me) {
                        var tu = new message(function (data) {
                            var h = render.fill($("#tpl_systemMessage"),data);
                            $(".pageable .symes").html(h);
                            pge.resetload();
                        });
                        tu.list({type:"message",pageNumber: 1});
                    },
                    loadDownFn :function(me) {
                        var td = new message(function (data) {
                            pge.pageNumber = me.pageNumber +1;
                            var h = render.fill($("#tpl_systemMessage"),data);
                            $(".pageable .symes").append(h);
                            if (data.length<20){
                                pge.lock();
                                pge.noData();
                            }
                            pge.resetload();
                        });
                        td.list({type:"message",pageNumber: me.pageNumber});
                    }
                }
        );

    })
</script>
</script>

<!--钱包-->
<script type="text/html" id="tpl_purse-index">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
            <div class="weui-tab">
                <!--BEGIN user_wallet-->
                <div class="user_wallet">
                    <div class="section1 f16">
                        <p>当前余额</p>
                        <p>￥<span id="balance">0.00</span></p>
                    </div>

                    <!--<div class="section2 f16">-->
                        <!--<p>可提现</p>-->
                        <!--<p>￥<span id="canget">0</span></p>-->
                    <!--</div>-->
                    <div class="section3">
                        <ul class="weui-flex">
                            <li class="weui-flex__item " >
                                <a href="member-home.html#charge">
                                    <div class="shop_img"><i class="icon iconfont icon-purse" style="color:#10aeff"></i><p class="f14">充值</p></div>
                                </a>
                            </li>
                            <li class="weui-flex__item">
                                <a href="javascript:;" id="gotocash">
                                    <div class="shop_img"><i class="icon iconfont coupon-01" style="color: #ff6d06"></i><p class="f14">提现</p></div>
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="section4">
                        <div class="weui-cells weui-cells__access" >
                            <a class="weui-cell gotomybank" href="javascript:;">
                                <div class="weui__cell_hd">
                                    <i class="icon iconfont icon-creditcard"></i>
                                </div>
                                <div class="weui-cell__bd  f14">
                                    <p>银行卡</p>
                                </div>
                                <div class="weui-cell__ft">
                                    <i class="icon iconfont"></i>
                                </div>
                            </a>
                        </div>
                        <div class="weui-cells weui-cells__access" >
                            <a class="weui-cell" href="member-home.html#bill-list">
                                <div class="weui__cell_hd">
                                    <i class="icon iconfont icon-bill"></i>
                                </div>
                                <div class="weui-cell__bd  f14">
                                    <p>账单</p>
                                </div>
                                <div class="weui-cell__ft">
                                    <i class="icon iconfont"></i>
                                </div>
                            </a>
                        </div>
                    </div>

                </div>
                <!--END user_wallet-->
            </div>
         </div>
    </div>
</div>

<script type="text/javascript">

    $(function () {

        document.title='我的钱包';
        var balance=new member(function(data){
            $('#balance').html(data.balance);
            $("#canget").html(data.balance);
        });
        balance.balance();

        //跳转银行卡页面，判断是否实名，实名后才能跳转
        $('.gotomybank').click(function(){
            var m=new member(function(data){
                console.log(data);
                if(data.authStatus=='success'){
                    pageManager.go('bank');
                }else{
                    dialog.show("实名认证后才可使用此功能!")
                }
            });
            m.index();
        })
        //跳转提现页面，判断是否实名，实名后才能跳转
        $('#gotocash').click(function(){
            var m=new member(function(data){
                console.log(data);
                if(data.authStatus=='success'){
                    pageManager.go('cash');
                }else{
                    dialog.show("实名认证后才可使用此功能!")
                }
            });
            m.index();
        });

    });

</script>



</script>
<script type="text/html" id="tpl_charge">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <!--BEGIN user_recharge-->
            <div class="user_recharge">
                <div class="section1">
                    <p>当前余额</p>
                    <p>￥<span id="nowbalance">0.00</span></p>
                </div>

                <div class="section2">
                    <div class="weui-cell">
                        <div class="weui-cell__hd f14"><label class="weui-label">金额(￥)</label></div>
                        <div class="weui-cell__bd weui-cell_primary f14">
                            <input class="weui-input" type="number" placeholder="请输入充值金额" id="amount">
                        </div>
                    </div>
                </div>

                <div class="section3">
                    <div class="weui-btn-area">
                        <a href="javascript:;" class="weui-btn btn-default" style="border-radius: 5px;">提交</a>
                    </div>
                </div>
            </div>
            <!--end user_recharge-->
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        document.title='充值';


        $(document).ready(function () {
            var h=$(window).height();
            $(window).resize(function() {
                if($(window).height()<h){
                    $('.weui-btn-area').hide();
                }
                if($(window).height()>=h){
                    $('.weui-btn-area').show();
                }
            });
        });

        //显示当前余额
        var me=new member(function(data){
            $('#nowbalance').html(data.balance);
        });
        me.balance();

        //提交充值的余额
        $('.section3 .weui-btn-area a').click(function () {
            var amount = $('.section2 #amount').val();
            var me = new member(function (data) {
                location.href=location.origin+'/weixin/payment/pay.html?sn='+data;
            });
            me.fill({amount: amount});
        });

//
//        pushHistory();
//        var bool=false;
//        setTimeout(function(){
//            bool=true;
//        },100);
//        window.addEventListener("popstate", function(e) {
//            if(bool)
//            {
//                location.href=location.origin+"/weixin/member/member-home.html#purse-index";
//            }
//            pushHistory();
//
//        }, false);
//        function pushHistory() {
//            var state = {
//                title: "title",
//                url: "#"
//            };
//            window.history.pushState(state,"title","#");
//        }

            });
</script>
</script>
<script type="text/html" id="tpl_checkout">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel">
                <!--BEGIN myshou-->
                <div class="myshou">
                    <div class="weui-cells">
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">收款金额</label></div>
                            <div class="weui-cell__bd weui-cell_primary f14">
                                <input class="weui-input firstmoney" type="number" placeholder="请输入收款金额">
                            </div>
                        </div>
                    </div>

                    <div class="weui-cells" style="background: #000;">
                        <div class="weui-cell">
                            <p class="f14" style="color:#fff; margin: 0 auto;"><i class="icon iconfont icon-wechat" style="color:#fff;background: #1AAD19; padding:1px;font-size: 4vw; border-radius: 3px"></i>微信钱包</p>
                        </div>

                    </div>
                    <div class="weui-cell" style="height:2vw;background: #e2e2e2;">
                        <p class="f12">每日限额:200000.00元，每笔限额：200000.00元</p>
                    </div>
                    <article class="weui-article" style="background: #fff;padding: 10px 15px">
                        <h2>交易安全描述</h2>
                        <section style="margin: 0;">
                            <p>
                                微店将配合银行卡共同打击无真实交易背景的虚假交易，银行卡转账套现或洗钱等被禁止的交易行为，请如实交易，否则款项将不能提现！</p>
                        </section>

                    </article>

                    <div class="section3 my_btn">
                        <div class="weui-btn-area">
                            <a href="javascript:;" class="weui-btn btn-default" style=" background: #e4393c;">下一步</a>
                        </div>
                    </div>

                    <div class="shoukuan">
                        <div class="lineone">
                            <i class="icon iconfont icon-remove-02"></i>
                            <p class="f14">微信扫一扫，向我付款</p>
                        </div>
                        <div class="erwei">
                            <img src="" alt="" id="qrode">
                        </div>
                        <p>￥<span class="shoumoney">1200</span></p>
                    </div>

                    <div class="weui-mask" id="iosMask" style="display: none"></div>

                </div>

                <!--END myshou-->

            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        document.title='收款';
        var $iosMask = $('#iosMask');
        //关闭收款弹框
        $('.shoukuan .icon-remove-02').click(function(){
            $('.shoukuan').css("display","none");
            $iosMask.fadeOut(200);
        });


        //下一步按钮点击
        $('.myshou .my_btn').click(function(){
            var amount=$(".myshou .firstmoney").val();
            var m=new member(function(data){
                console.log(data);
                $.ajax({
                    url:"http://api.wwei.cn/wwei.html?apikey=20160806215020&data="+data.code_url,
                    type:'post',
                    dataType:"jsonp",
                    jsonp: "callback",
                    success:function(result){
                        $("#qrode").attr("src",result.data.qr_filepath);
                    }
                });
            });
            m.cashier({
                paymentPluginId:"weixinQrcodePayPlugin",
                amount:amount
            })
            if($(".myshou .firstmoney").val()==''){
                dialog.show("请输入收款金额！")
            }else{
                $iosMask.fadeIn(200);
                function hideActionSheet() {
                    $iosMask.fadeOut(200);
                }
                $iosMask.on('click', hideActionSheet);
                //打开收款二维码
                $('.shoukuan').css("display","block");

                //同步收款价格
                $('.shoukuan .shoumoney').html($(".myshou .firstmoney").val());
            }
        });


    });
</script>
</script>
<script type="text/html" id="tpl_cash">
<div class="page cash">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    
<div class="chooseWidget weui-tab__panel" style="width:100%;background: #FFFFFF;position: fixed;z-index: 1000;display: none; padding: 0">
</div>

    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel">
                <!--BEGIN user_getcash-->
                <div class="user_getcash" page="1">
                    <div class="section1">
                        <p class="f14">当前余额</p>
                        <p class="f14">￥<span id="nowbalance">0.00</span></p>
                    </div>

                    <div class="weui-cells">
                        <a href="script:;">
                            <div class="weui-cell" id="choosemybanks">
                                <div class="weui-cell__hd f14"><label class="weui-label">银行卡</label></div>
                                <div class="weui-cell__bd weui-cell_primary f14">
                                    <!--<input class="weui-input" type="tel" placeholder="请选择银行" id="selbank">-->
                                </div>
                                <div class="weui-cell__ft">

                                    <input class="weui-input" type="tel" placeholder="请选择银行>" id="selbank">
                                    <!--<i class="icon iconfont"></i>-->
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="weui-cells">
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">提现金额￥</label></div>
                            <div class="weui-cell__bd"></div>
                            <div class="weui-cell__ft weui-cell_primary f14">
                                <input class="weui-input" type="number" placeholder="请输入提现金额" id="getcash">
                            </div>
                        </div>
                    </div>
                    <div class="weui-cells">
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">实际到账金额￥</label></div>
                            <div class="weui-cell__bd weui-cell_primary f14">
                                <input class="weui-input" type="tel" disabled value="" id="trueamount">
                            </div>
                        </div>
                    </div>

                    <p class="tip">手续费：￥<span id="tip">0.00</span></p>

                    <div class="section3 my_btn">
                        <div class="weui-btn-area">
                            <a href="javascript:;" class="weui-btn btn-default">提交</a>
                        </div>
                    </div>


                    <div class="cashpay">
                        <p class="Ftitle">请输入支付密码</p>
                        <p class="f14">零钱</p>
                        <p id="cashmoney">100.00</p>
                        <div class="pwd-box">
                            <input type="tel" maxlength="6" class="pwd-input" id="pwd-input" autocomplete="off">
                            <div class="fake-box">
                                <input type="password" readonly="" autocomplete="off" unselectable="on">
                                <input type="password" readonly="" autocomplete="off" unselectable="on">
                                <input type="password" readonly="" autocomplete="off" unselectable="on">
                                <input type="password" readonly="" autocomplete="off" unselectable="on">
                                <input type="password" readonly="" autocomplete="off" unselectable="on">
                                <input type="password" readonly="" autocomplete="off" unselectable="on">
                            </div>
                        </div>
                        <p><i class="icon iconfont icon-remove-02"></i></p>
                        <p class="f12" style=" margin-top:5px"><a href="../payment/paypassword.html">忘记密码</a></p>
                    </div>

                    <div class="weui-mask" id="iosMask" style="display: none"></div>

                </div>

                <!--END user_recharge-->

            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(function () {
        document.title='提现';

        //选择我的银行卡
        $("#choosemybanks").click(function () {
            $('.user_getcash').hide();
            choosemybank.bank();
            choosemybank.callBack=function (bank) {
                $("#selbank").val(bank.name+bank.cardNo);
                $("#selbank").attr('bankid',bank.id)
                $('.user_getcash').show();
            };
        });


        //显示当前余额
        var me=new member(function(data){
            $('#nowbalance').html(data.balance);
        });
        me.balance();


        //根据提现金额计算手续费并显示
        $('#getcash').change(function(){
            var getcash=$('#getcash').val();  //提现金额
            var me=new member(function(data){
                console.log(data);
                $('#tip').html(data);           //手续费
                $('#trueamount').val(getcash-data); //实际到账金额
            });
            me.calcFee({amount:getcash});
        });


        //提交后弹开密码框
        var $iosMask = $('#iosMask');
        function hideActionSheet() {
            $iosMask.fadeOut(200);
            $('.cashpay').css("display", 'none');
        };
        $iosMask.on('click', hideActionSheet);
        $('.user_getcash .section3').click(function(){
            if($("#selbank").val()==''){
                toast.show('请选择银行');
            }else if($("#getcash").val()==''){
                toast.show('请输入提现金额');
            }else{
                $iosMask.fadeIn(200);
                $('.user_getcash .cashpay').css("display",'block');
                $('input[type="tel"]').focus();
                $('.chooseWidget').hide();
                $("#cashmoney").html($("#getcash").val());   //同步到密码框里面的金额
            }
        });

        //按钮关闭密码框

        $(".user_getcash .icon-remove-02").click(function(){
            $iosMask.fadeOut(200);
            $('.user_getcash .cashpay').css("display",'none');
        })


        //密码框js控制
        var $input = $(".fake-box input");
        $("#pwd-input").on("input", function() {
            var pwd = $(this).val().trim();
            for (var i = 0, len = pwd.length; i < len; i++) {
                $input.eq("" + i + "").val(pwd[i]);
            }
            $input.each(function() {
                var index = $(this).index();
                if (index >= len) {
                    $(this).val("");
                }
            });
            if (len == 6) {
                //密码到达6位数后执行接口
                bankid=$('#selbank').attr('bankid');   //银行卡id
                amount=$("#getcash").val();            //提现数额
                var cm=new common(function (data){
                    console.log(data);
                    var rsaKey = new RSAKey();
                    rsaKey.setPublic(b64tohex(data.modulus), b64tohex(data.exponent));
                    var enPassword = hex2b64(rsaKey.encrypt(pwd));
                    var me=new member(function(data){
                        console.log(data);
                        $('input[type="tel"]').blur();
                        $('.user_getcash .cashpay').css("display",'none');
                        dialog.show("提现成功");
                        setTimeout(function (){
                           location.reload();
                        },1000);
                    });
                    me.cash({memberBankId:bankid,amount:amount,enPassword:enPassword})
                });
                cm.getPublicKey();

            }
        });
    });


</script>



</script>
<script type="text/html" id="tpl_bank">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel">
                <div class="mybankcart weui-cells"></div>
            </div>
            <div class="addbank weui-btn-area">
                <a href="javascript:pageManager.go('addBank');" class="weui-btn btn-default">+添加银行卡</a>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        document.title='我的银行卡';

        var td = new bank(function (data) {
            var h = render.fill($("#tpl_bankcard"),data);
            $(".mybankcart").append(h);
        });
        td.list({pageNumber:1});

    });
</script>
</script>
<script type="text/html" id="tpl_addBank">
<div class="page">
    
<div class="chooseWidget weui-tab__panel" style="width:100%;background: #FFFFFF;position: fixed;z-index: 1000;display: none; padding: 0">
</div>

    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <!--BEGIN user_addbank-->
            <div class="user_addbank" page="1">
                <p class="f12" style="padding: 5px 15px 0;">信息加密处理，仅用于银行验证</p>
                <div class="weui-cells weui-cells_form" style="margin-top: 5px">
                    <div class="weui-cell" id="choosebank" >
                        <div class="weui-cell__hd f14"><label class="weui-label">银行选择</label></div>
                        <div class="weui-cell__bd f14">
                            <span id="bankName" class="clr-orange">请选择银行</span>
                        </div>

                    </div>
                </div>

                <div class="weui-cells weui-cells_form">
                    <div class="weui-cell">
                        <div class="weui-cell__hd f14"><label  class="weui-label">卡号</label></div>
                        <div class="weui-cell__bd f14">
                            <input class="weui-input" type="number" pattern="[0-9]*"  placeholder="请输入卡号" id="cardnum"/>
                        </div>
                        <div class="weui-cell__ft">
                        </div>
                    </div>
                </div>
                <div class="weui-cells weui-cells_form">
                    <div class="weui-cell">
                        <div class="weui-cell__hd f14"><label class="weui-label">姓名</label></div>
                        <div class="weui-cell__bd f14">
                            <input class="weui-input"  placeholder="请输入姓名" id="name"/>
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__hd f14"><label class="weui-label">证件号</label></div>
                        <div class="weui-cell__bd f14">
                            <input class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入证件号" id="idcard"/>
                        </div>
                    </div>
                </div>

                <div class="weui-cells ">
                    <div class="weui-cell ">
                        <div class="weui-cell__hd f14"><label class="weui-label">手机号</label></div>
                        <div class="weui-cell__bd f14">
                            <input class="weui-input" type="number" id="phonenumber" placeholder="请输入手机号"/>
                        </div>
                    </div>
                    <div class="weui-cell ">
                        <div class="weui-cell__hd f14" style=" width: 10vw;"><label class="weui-label">验证码</label></div>
                        <div class="weui-cell__bd f14" style="margin-left:18vw;">
                            <input class="weui-input" placeholder="输入验证码"  id="validate" />
                        </div>
                        <div class="weui-cell_ft f14">
                            <input type="button" id="getvalidate" class="weui-btn weui-btn__primary" style="background:#00a0e9;font-size: 12px;"  value="发送验证码">
                        </div>
                    </div>
                </div>
                <label for="weuiAgree" class="weui-agree">
                    <input id="weuiAgree" type="checkbox" class="weui-agree__checkbox" checked>
                    <span class="weui-agree__text">
                      同意<a href="javascript:void(0);">《服务协议》</a>
                    </span>
                </label>

                <div class="weui-btn-area">
                    <a class="weui-btn btn-default" id="addbank" style="border-radius: 5px">下一步</a>
                </div>

            </div>
            <!--END user_addbank-->
        </div>
    </div>
</div>

<script type="text/javascript">
    var countdown=60;
    function settime(val) {
            if (countdown == 0) {
                val.removeAttribute("disabled");
                val.value="发送验证码";
                val.style.background="#00a0e9";
                countdown = 60;
                return;
            } else {
                val.setAttribute("disabled", true);
                val.value="重新发送(" + countdown + ")";
                val.style.background="#999";
                countdown--;
            }
            setTimeout(function() {
                settime(val)
            },1000)
    }
    $(function () {
        document.title='添加银行卡';

        $("#choosebank").click(function () {
            choosebank.bank();
            choosebank.callBack=function (bank) {
                $("#bankName").text(bank.name);
                $("#bankName").attr('bankid',bank.id)
            };
        });
        //添加卡
        $("#addbank").click(function(){

            var check=document.getElementById('weuiAgree');
            var bankid=$("#bankName").attr('bankid');
            var cardnum=$("#cardnum").val();
            var name=$("#name").val();
            var idcard=$("#idcard").val();
            var phonenumber=$("#phonenumber").val();
            var validate=$("#validate").val();
            if(cardnum==''||name==''||idcard==''||phonenumber==''||validate==''){
                toast.show('请填写信息完整');
            }else if(check.checked==true){
                var ba=new bank(function(data){
                    console.log(data);
                    dialog.show("添加成功");
                    setTimeout(function () {
                        pageManager.back();
                    },1000);
                });
                ba.save({captcha:validate,bankInfoId:bankid,cardNo:cardnum,depositUser:name,idCardNo:idcard});

            }else{
                toast.show('请同意服务协议')
            }
        })


        //获取验证码
        $("#getvalidate").on('click',function (){
            var $this=this;
            var phonenum=$("#phonenumber").val();
            if((!(/^1[34578]\d{9}$/.test(phonenum)))){
                toast.show('请输入正确手机号码！')
            } else{
                var ba = new bank(function (data) {
                    settime($this);
                    console.log(data);
                    toast.show("已发送");
                });
                ba.sendCode({mobile: phonenum})
            }
        })

    });
</script>
</script>
<script type="text/html" id="tpl_bill-list">
<div class="page user_bill">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-loading weui-icon_toast"></i>
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">弹窗标题</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-flex">
            <div class="weui-flex__item" id="showDatePicker"><div class="placeholder"><p><span id="z1">2016</span>年</p><p><span id="z2">12</span>月</p></div></div>
            <div class="weui-flex__item"><div class="placeholder"><p>支出(元)</p><p id="total_outcome">0.00</p></div></div>
            <div class="weui-flex__item"><div class="placeholder"></div><p>收入(元)</p><p id="total_income">0.00</p></div>
        </div>
        <div class="weui-tab" style="clear:both">
            <div class="weui-navbar">
                <div class="weui-navbar__item active f16" style="color:red;">
                    明细
                </div>
                <div class="weui-navbar__item f16">
                    统计
                </div>
            </div>
            <div class="weui-tab__panel pageable" style="padding-top: 110px">
                <div class="billdt" style="padding-top:0px"></div>
            </div>
            <div class="weui-tab__panel" style="display:none;padding-bottom: 0; background: #e9e9e9;">
                <div class="census">
                    <div class="weui-cells">
                        <div class="weui-cell">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-l-bc-01" style="background:#fa6a05;color:#fff"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>贷款收入<span class="receipts">0</span>%</p>
                                <div style="background:#fa6a05;border-radius:10px; height: 8px; margin-top: 5px;"></div>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>+￥<span id="receipts">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-purse-02" style="background:#fa6a05;color:#fff"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>分润收入<span class="profit">0</span>%</p>
                                <div style="background:#fa6a05;border-radius:10px; height: 8px; margin-top: 5px;"></div>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>+￥<span id="profit">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-carto" style="background:#fa6a05;color:#fff"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>交易佣金<span class="rebate">0</span>% </p>
                                <div style="background:#fa6a05;border-radius:10px; height: 8px; margin-top: 5px;"></div>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>-￥<span id="rebate">0.00</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cells">
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-l-bc-01" style="background:#88cb40;color:#fff;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>购物支出<span class="payment">0</span>%</p>
                                <div style="background:#88cb40;border-radius:10px; height: 8px; margin-top: 5px;"></div>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>-￥<span id="payment">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-purse-02" style="background:#88cb40;color:#fff;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>线下收款<span class="cashier">0</span>%</p>
                                <div style="background:#88cb40;border-radius:10px; height: 8px; margin-top: 5px;"></div>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>+￥<span id="cashier">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-carto" style="background:#88cb40;color:#fff;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>其他支出<span class="outcome">0</span>%</p>
                                <div style="background:#88cb40;border-radius:10px; height: 8px; margin-top: 5px;"></div>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>-￥<span id="outcome">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-purse-02" style="background:#88cb40;color:#fff;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>其他收入<span class="income">0</span>%</p>
                                <div style="background:#88cb40;border-radius:10px; height: 8px; margin-top: 5px;"></div>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>+￥<span id="income">0.00</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cells">
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-l-bc-01"  style="background:#bababa;color:#fff;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>充值收入<span class="recharge">0</span>%</p>
                                <div style="background:#bababa;border-radius:10px; height: 8px; margin-top: 5px;"></div>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>+￥<span id="recharge">0.00</span></p>
                            </div>
                        </div>
                        <div class="weui-cell ">
                            <div class="weui-cell__hd">
                                <i class="icon iconfont icon-purse-02" style="background:#bababa;color:#fff;"></i>
                            </div>
                            <div class="weui-cell__bd weui-cell__primary f14">
                                <p>提现支出<span class="withdraw">0</span>%</p>
                                <div style="background:#bababa;border-radius:10px; height: 8px; margin-top: 5px;"></div>
                            </div>
                            <div class="weui-cell__ft f14">
                                <p>-￥<span id="withdraw">0.00</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        document.title='账单';

        //(账单与明细)选项卡切换
        $('.weui-navbar__item').on('click', function () {
            $(this).addClass('active').siblings().removeClass('active');
            $(this).css("color",'red').siblings().css('color','#000');
            $(this).parent().parent().children().eq($(this).index()+1).css("display","block").siblings('.weui-tab__panel').css("display","none")
        });

        //获取当前年月
        var date=new Date;
        var year=date.getFullYear();
        var month=date.getMonth()+1;
        month =(month<10 ? "0"+month:month);
        var mydate = (year.toString()+'-'+month.toString());
        var nowyear=year.toString();
        var nowmonth=month.toString();
        $("#z1").html(nowyear);
        $("#z2").html(nowmonth);
        var nowdate;
        nowdate=mydate+'-01'+' '+'00:00:00';  //开始时间为当前月份第一天零点

        //默认显示当前月份账单明细
        var jsons={begin_date:nowdate,pageNumber:1};
        var loadUpFn=function () {
            jsons.pageNumber=1;
            var tu = new deposit(function (data) {
                jsons.pageNumber+=1;
                var h = render.fill($("#tpl_bills"),data);
                $(".pageable .billdt").html(h);
                pge.resetload();
            });
            tu.list(jsons);
        };
        var pge = $(".pageable").pageable({
                    loadUpFn:loadUpFn,
                    loadDownFn :function(me) {
                        var td = new deposit(function (data) {
                            jsons.pageNumber+=1;
                            var h = render.fill($("#tpl_bills"),data);
                            $(".pageable .billdt").append(h);
                            if (data.length<20){
                                pge.lock();
                                pge.noData();
                            }
                            pge.resetload();
                        });
                        td.list(jsons);
                    }
                }
        );

        //默认显示当前月份账单统计
        var de=new deposit(function(data){
            console.log(data);
            $("#total_income").html(data.total_income);                                        //总收入
            $("#total_outcome").html(data.total_outcome);                                      //总支出

            $("#receipts").html(data.receipts);                                                //贷款收入
            var receipts=Math.round(data.receipts/data.total_income * 10000)/100.00;
            $(".receipts").html(receipts);                                                      //贷款收入百分比
            $(".receipts").parent().next('div').width(receipts+'%');

            $("#profit").html(data.profit);                                                    //分润收入
            var profit=Math.round(data.profit/data.total_income * 10000)/100.00;
            $(".profit").html(profit);                                                          //分润收入百分比
            $(".profit").parent().next('div').width(profit+'%');

            $("#rebate").html(data.rebate);                                                    //佣金支出
            var rebate=Math.round(data.rebate/data.total_outcome * 10000)/100.00;
            $(".rebate").html(rebate);                                                          //佣金支出百分比
            $(".rebate").parent().next('div').width(rebate+'%');

            $("#payment").html(data.payment);                                                  //购物支出
            var payment=Math.round(data.payment/data.total_outcome * 10000)/100.00;
            $(".payment").html(payment);                                                    //购物支出百分比
            $(".payment").parent().next('div').width(payment+'%');

            $("#cashier").html(data.cashier);                                                  //收款收入
            var cashier=Math.round(data.cashier/data.total_income * 10000)/100.00;
            $(".cashier").html(cashier);                                                     //收款收入百分比
            $(".cashier").parent().next('div').width(cashier+'%');

            $("#outcome").html(data.outcome);                                                  //其他支出
            var outcome=Math.round(data.outcome/data.total_outcome * 10000)/100.00;
            $(".outcome").html(outcome);                                                    //其他支出百分比
            $(".outcome").parent().next('div').width(outcome+'%');


            $("#income").html(data.income);                                                    //其他收入
            var income=Math.round(data.income/data.total_income * 10000)/100.00;
            $(".income").html(income);                                                          //其他收入百分比
            $(".income").parent().next('div').width(income+'%');

            $("#recharge").html(data.recharge);                                                //充值收入
            var recharge=Math.round(data.recharge/data.total_income * 10000)/100.00;
            $(".recharge").html(recharge);                                                      //充值收入百分比
            $(".recharge").parent().next('div').width(recharge+'%');

            $("#withdraw").html(data.withdraw);                                                //提现支出
            var withdraw=Math.round(data.withdraw/data.total_outcome * 10000)/100.00;
            $(".withdraw").html(withdraw);                                                      //提现支出百分比
            $(".withdraw").parent().next('div').width(withdraw+'%');

            if(data.total_income==0){
                $(".profit").html(0);
                $(".profit").parent().next('div').width('0%');
                $(".receipts").html(0);
                $(".receipts").parent().next('div').width('0%');
                $(".recharge").html(0);
                $(".recharge").parent().next('div').width('0%');
                $(".income").html(0);
                $(".income").parent().next('div').width('0%');
                $(".cashier").html(0);
                $(".cashier").parent().next('div').width('0%');
            }
            if(data.total_outcome==0){
                $(".rebate").html(0);
                $(".rebate").parent().next('div').width('0%');
                $(".payment").html(0);
                $(".payment").parent().next('div').width('0%');
                $(".outcome").html(0);
                $(".outcome").parent().next('div').width('0%');
                $(".withdraw").html(0);
                $(".withdraw").parent().next('div').width('0%');
            }

        });
        de.sumer({begin_date:nowdate});


        //打开日期选择控件
        $('#showDatePicker').on('click', function () {
            weui.datePicker({
                start: 2015,                //开始月份
                end: new Date().getFullYear(),  //结束为当前年份
                //日期选择时执行方法
                onChange: function (result) {
                    //隐藏日的显示,只显示年月
                    $('.weui-picker__group').eq(2).css('display','none');
                    $('#z1').html(result[0]);     //选择时当前年份值
                    $('#z2').html(result[1]+1);   //选择时当前月份值
                    console.log(result[0]);
                    console.log(result[1]);
                },

                //日期确定后执行方法
                onConfirm: function (result) {
                    console.log(result[0]);
                    //隐藏日的显示,只显示年月
                    $('.weui-picker__group').eq(2).css('display','none');
                    $(".pageable .billdt").html('');
                    var z1=result[0];
                    var z2=result[1]+1;
                    $('.user_bill .calender').css("display",'none');
                    var begin_date=z1+'-'+z2+'-1'+' '+'00:00:00';
                    var end_date = z1 + '-' + (z2 + 1) + '-1' + ' ' + '00:00:00';

                    //日期确定后，读取查询日期的账单统计
                    var de=new deposit(function(data){
                        console.log(data);
                        $("#total_income").html(data.total_income);                                        //总收入
                        $("#total_outcome").html(data.total_outcome);                                      //总支出
                        $("#receipts").html(data.receipts);                                                //贷款收入
                        var receipts=Math.round(data.receipts/data.total_income * 10000)/100.00;
                        $(".receipts").html(receipts);                                                      //贷款收入百分比
                        $(".receipts").parent().next('div').width(receipts+'%');

                        $("#profit").html(data.profit);                                                    //分润收入
                        var profit=Math.round(data.profit/data.total_income * 10000)/100.00;
                        $(".profit").html(profit);                                                          //分润收入百分比
                        $(".profit").parent().next('div').width(profit+'%');

                        $("#rebate").html(data.rebate);                                                    //佣金支出
                        var rebate=Math.round(data.rebate/data.total_outcome * 10000)/100.00;
                        $(".rebate").html(rebate);                                                          //佣金支出百分比
                        $(".rebate").parent().next('div').width(rebate+'%');

                        $("#payment").html(data.payment);                                                  //购物支出
                        var payment=Math.round(data.payment/data.total_outcome * 10000)/100.00;
                        $(".payment").html(payment);                                                    //购物支出百分比
                        $(".payment").parent().next('div').width(payment+'%');

                        $("#cashier").html(data.cashier);                                                  //收款收入
                        var cashier=Math.round(data.cashier/data.total_income * 10000)/100.00;
                        $(".cashier").html(cashier);                                                     //收款收入百分比
                        $(".cashier").parent().next('div').width(cashier+'%');

                        $("#outcome").html(data.outcome);                                                  //其他支出
                        var outcome=Math.round(data.outcome/data.total_outcome * 10000)/100.00;
                        $(".outcome").html(outcome);                                                    //其他支出百分比
                        $(".outcome").parent().next('div').width(outcome+'%');

                        $("#income").html(data.income);                                                    //其他收入
                        var income=Math.round(data.income/data.total_income * 10000)/100.00;
                        $(".income").html(income);                                                          //其他收入百分比
                        $(".income").parent().next('div').width(income+'%');

                        $("#recharge").html(data.recharge);                                                //充值收入
                        var recharge=Math.round(data.recharge/data.total_income * 10000)/100.00;
                        $(".recharge").html(recharge);                                                      //充值收入百分比
                        $(".recharge").parent().next('div').width(recharge+'%');

                        $("#withdraw").html(data.withdraw);                                                //提现支出
                        var withdraw=Math.round(data.withdraw/data.total_outcome * 10000)/100.00;
                        $(".withdraw").html(withdraw);                                                      //提现支出百分比
                        $(".withdraw").parent().next('div').width(withdraw+'%');

                        if(data.total_income==0){
                            $(".profit").html(0);
                            $(".profit").parent().next('div').width('0%');
                            $(".receipts").html(0);
                            $(".receipts").parent().next('div').width('0%');
                            $(".recharge").html(0);
                            $(".recharge").parent().next('div').width('0%');
                            $(".income").html(0);
                            $(".income").parent().next('div').width('0%');
                            $(".cashier").html(0);
                            $(".cashier").parent().next('div').width('0%');
                        }
                        if(data.total_outcome==0){
                            $(".rebate").html(0);
                            $(".rebate").parent().next('div').width('0%');
                            $(".payment").html(0);
                            $(".payment").parent().next('div').width('0%');
                            $(".outcome").html(0);
                            $(".outcome").parent().next('div').width('0%');
                            $(".withdraw").html(0);
                            $(".withdraw").parent().next('div').width('0%');
                        }
                    });
                    de.sumer({begin_date:begin_date,end_date:end_date});

                    //日期确定后，读取查询日期的账单明细
                    jsons={
                        begin_date:begin_date,
                        end_date:end_date,
                        pageNumber:1
                    };
                    loadUpFn();
                }
            });
            $('.weui-picker__group').eq(2).css('display','none');
        });

    });
</script>





</script>

<!--优惠券-->
<script type="text/html" id="tpl_coupons">
<div class="page">
    <div class="page__bd tabBer" style="height: 100%;">
            <div class="vux-tab">
                <div class="vux-tab-item vux-center f14 myRedPacket"><a href="../member/redPacket.html">我的红包</a></div>
                <div class="vux-tab-item vux-center f14  vux-tab-selected myCoupon"><a href="../member/coupon.html">我的优惠券</a></div>
                <div class="vux-tab-ink-bar vux-tab-ink-bar-transition-forward" id="bor" style=" right: 0; left: 50%;"></div>
            </div>

            <div class="weui-tab pageable" style="clear:both;background:#f8f8f8">
                <div class="vux-swiper-item active">
                    <div class="sc conpon"></div>
                </div>
            </div>
    </div>
</div>



<script type="text/javascript">
    $(function () {
        //使用红包
        $('body').on("click", "#user", function () {
            var code = $(this).attr("code");
            var red = new redPacket(function (data) {
                location.href=location.origin+'/weixin/member/index.html?code='+code+'&tenantName='+escape(data.tenantName)+'#useRedPacket';
            });
            red.use({code: code});
        });

    //加载我的优惠券模板

             var page = $(".pageable").pageable({
                loadUpFn:function(me) {
                    var tu = new coupon(function (data) {
                        var h = render.fill($("#tpl_coupon"),data);
                        $(".pageable .conpon").html(h);
                        me.resetload();
                    });
                    tu.list({pageNumber: 1});
                },
                loadDownFn :function(me) {
                    var td = new coupon(function (data) {
                        me.pageNumber = me.pageNumber +1;
                        var h = render.fill($("#tpl_coupon"),data);
                        $(".pageable .conpon").append(h);
                        if (data.length<20){
                            me.lock();
                            me.noData();
                        }
                        me.resetload();
                    });
                    td.list({pageNumber: me.pageNumber});
                }
            }
        );

        pushHistory();
        var bool=false;
        setTimeout(function(){
            bool=true;
        },100);
        window.addEventListener("popstate", function(e) {
            if(bool)
            {
                $('.pageable-down').remove();
                location.href=location.origin+"/weixin/member/member-home.html";
            }
            pushHistory();

        }, false);
        function pushHistory() {
            var state = {
                title: "title",
                url: "#"
            };
            window.history.pushState(state,"title","#");
        }

    });

</script>
</script>

<!--收藏-->
<script type="text/html" id="tpl_favorite-tenant">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd tabBer" style="height: 100%;">
        <div class="vux-tab">
            <div class="vux-tab-item vux-center f14 vux-tab-selected"><a href="../member/favorite-product.html">收藏宝贝</a></div>
            <!--<div class="vux-tab-ink-bar vux-tab-ink-bar-transition-forward" id="bor" style=" left: 0; right:66.66%;"></div>-->
        </div>
        <div class="weui-tab " style="clear:both">
            <!--加载收藏商家-->
            <div class="vux-swiper-item active  user_collect weui-tab__panel pageable"  style="padding: 43px 0 0 0;">

                <div class="weui-cells collshop" >
                </div>
            </div>

        </div>
    </div>
</div>
</div>



<script type="text/javascript">
    $(function () {
        document.title='收藏';

        //定位，获取经纬度
        var jsonsData = {
            pageNumber: 1,
            lat: weixin.lat,
            lng: weixin.lng
        };
        var pge;
        weixin.location(function () {
            jsonsData.lat=weixin.lat;
            jsonsData.lng=weixin.lng;
            pge = $(".pageable").pageable({
                        loadUpFn:function(me) {
                            weixin.location(function () {
                                console.log("lat:" + weixin.lat);
                                console.log("lng:" + weixin.lng);
                            });
                            var tu = new favorite(function (data) {
                                var h = render.fill($("#tpl_collectshop"),data);
                                console.log(data);

                                $(".pageable .collshop").html(h);
                                me.resetload();
                            });
                            tu.tenantList(jsonsData);
                        },
                        loadDownFn :function(me) {
                            var td = new favorite(function (data) {
                                me.pageNumber = me.pageNumber +1;
                                var h = render.fill($("#tpl_collectshop"),data);
                                $(".pageable .collshop").append(h);
                                if (data.length<20){
                                    me.lock();
                                    me.noData();
                                }
                                me.resetload();
                            });
                            td.tenantList(jsonsData);
                        }
                    });
        });

        pushHistory();
        var bool=false;
        setTimeout(function(){
            bool=true;
        },100);
        window.addEventListener("popstate", function(e) {
            if(bool)
            {
                $('.pageable-down').remove();
                location.href=location.origin+"/weixin/member/member-home.html";
            }
            pushHistory();

        }, false);
        function pushHistory() {
            var state = {
                title: "title",
                url: "#"
            };
            window.history.pushState(state,"title","#");
        }
    });


</script>
</script>
<!--绑定手机-->
<script type="text/html" id="tpl_bound-phone">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab" style="background: #f8f8f8;">
            <!--BEGIN userPhone-->
            <div class="user_addphone">
                <p class="f12" style="padding: 5px 15px">请选择您的国家和地区</p>
                <div class="weui-cells" style="margin-top: 0;">
                    <div class="weui-cell weui-cell_select weui-cell_select-after">
                        <div class="weui-cell__hd f14">
                            <label  class="weui-label">国家/地区</label>
                        </div>
                        <div class="weui-cell__bd f14">
                            <select class="weui-select" name="select2">
                                <option value="1">中国</option>
                                <option value="2">美国</option>
                                <option value="3">英国</option>
                            </select>
                        </div>
                    </div>
                    <div class="weui-cell weui-cell_select weui-cell_select-before">
                        <div class="weui-cell__hd f14">
                            <select class="weui-select" name="select2">
                                <option value="1">+86</option>
                                <option value="2">+80</option>
                                <option value="3">+84</option>
                                <option value="4">+87</option>
                            </select>
                        </div>
                        <div class="weui-cell__bd f14">
                            <input class="weui-input" type="number" pattern="[0-9]*" placeholder="请输入手机号码" id="mobnum"/>
                        </div>
                    </div>
                </div>
                <div  class="weui-cells">
                    <div class="weui-cell weui-cell_vcode" style="padding:5px 15px;">
                        <div class="weui-cell__hd f14">
                            <label class="weui-label" style="width:60px;">验证码</label>
                        </div>
                        <div class="weui-cell__bd f14">
                            <input class="weui-input" type="tel" placeholder="请输入验证码" id="captcha">
                        </div>
                        <div class="weui-cell_ft">
                            <input type="button" id="getcap" class="weui-btn weui-btn__primary" style="background:#00a0e9;font-size: 12px;" value="发送验证码">
                        </div>
                    </div>
                </div>
                <div class="weui-cells">
                    <div class="weui-cell">
                        <div class="weui-cell__bd f14">
                            <input class="weui-input" type="tel" placeholder="若有邀请码，请输入邀请码" id="inviteCode">
                        </div>
                    </div>
                </div>
                <label for="weuiAgree" class="weui-agree">
                    <input id="weuiAgree" type="checkbox" class="weui-agree__checkbox" checked>
                    <span class="weui-agree__text">
                已阅读并同意<a href="javascript:void(0);">《挑货网--专业为实体店服务的网站-官方网站服务平台协议》</a>
            </span>
                </label>
                <div class="weui-btn-area">
                    <a class="weui-btn btn-default" href="javascript:" id="login">登 陆</a>
                </div>
            </div>
            <!--END userPhone-->
        </div>
    </div>
</div>
<script type="text/javascript">

    $(function () {
        document.title='绑定手机';

        var countdown=60;
        function settime(val) {
            if($('#phonenumber').val()!=""){
                if (countdown == 0) {
                    val.removeAttribute("disabled");
                    val.value="发送验证码";
                    val.style.background="#00a0e9";
                    countdown = 60;
                    return;
                } else {
                    val.setAttribute("disabled", true);
                    val.value="重新发送(" + countdown + ")";
                    val.style.background="#999";
                    countdown--;
                }
                setTimeout(function() {
                    settime(val)
                },1000)
            }

        }
        //绑定手机获取验证码
        $("#getcap").click(function(){
            var mobnum=$("#mobnum").val();
            if(mobnum==""){
                toast.show("请输入手机号码");
            }else{

                settime(this);
                var me=new member(function(data){
                    console.log(data);
                });
                me.sendCode({mobile:mobnum})
            }
        });

        //绑定手机
        $("#login").click(function(){
            var check=document.getElementById("weuiAgree");
            var mobnum=$("#mobnum").val();
            var capt=$("#captcha").val();
            var invite=$("#inviteCode").val();
            if(check.checked==true){
                var me=new member(function(data){
                    console.log(data)
                    toast.show("绑定成功");
                    setTimeout(function () {
                        window.location.href = document.referrer;
                    },1000);
                });
                me.bindMobile({mobile:mobnum,captcha:capt,inviteCode:invite});
            }else{
                toast.show("请同意协议")
            }
        })

    });
</script>
</script>
<!--我的地址-->
<script type="text/html" id="tpl_address-list">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    
<div class="chooseWidget weui-tab__panel" style="width:100%;background: #FFFFFF;position: fixed;z-index: 1000;display: none;">
</div>

    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel pageable" style="padding-bottom: 62px;">
                <div class="user_address addmy"></div>
            </div>
        </div>
        <div class="user_address">
            <div class="add_address weui-btn-area">
                <a class="weui-btn btn-default" href="javascript:" style="background:#fc560b;">+添加新地址</a>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function(){
        document.title='我的地址';

        if(localStorage.getItem('refreshed') !== 'true') {
            setTimeout(function(){
                window.location.reload();
            },0);
            return localStorage.setItem('refreshed', 'true');
        }
        localStorage.setItem('refreshed', 'false');

        $('.add_address').click(function(){
            pageManager.go('add-address');
            location.reload();
        });

        $("#changeArea").click(function () {
            choose.area();
            choose.callBack=function (area) {
                $("#myarea").text(area.fullName);
                $("#myarea").attr('area-id',area.id); //绑定区域id
            };
        });

        //读取地址列表
        var td = new receiver(function (data) {
            var h = render.fill($("#tpl_address"),data);
            $(".pageable .addmy").append(h);
        });
        td.list({pageNumber:1});
    });

</script>
</script>
<script type="text/html" id="tpl_add-address">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    
<div class="chooseWidget weui-tab__panel" style="width:100%;background: #FFFFFF;position: fixed;z-index: 1000;display: none;">
</div>

    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab" style="background: #f8f8f8">
            <div class="weui-tab__panel">

                <!--BEGIN user_address_add-->
                <div class="myaddressadd">

                    <div class="weui-cells weui-cells_form" style="margin-top:0">
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">收货人</label></div>
                            <div class="weui-cell__bd f14">
                                <input class="weui-input" type="text" placeholder="请输入收货姓名" id="consignee"/>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cells weui-cells_form">
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">联系方式</label></div>
                            <div class="weui-cell__bd f14">
                                <input class="weui-input" maxlength="11" type="number" pattern="[0-9]*" placeholder="请输入11位收货电话号" id="phone"/>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cells weui-cells_form">
                        <div class="weui-cell" id="changeArea" >
                            <div class="weui-cell__hd f14"><label class="weui-label">所在地区</label></div>
                            <div class="weui-cell__bd f14">
                                <span id="myarea"></span>
                            </div>
                            <div class="weui-cell__ft">
                                <i class="icon iconfont icon-right-01"></i>
                            </div>
                        </div>
                    </div>

                    <div class="weui-cells weui-cells_form">
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">详细地址</label></div>
                            <div class="weui-cell__bd f14">
                                <input class="weui-input" type="text" placeholder="请输入详细地址" id="address"/>
                            </div>
                        </div>
                    </div>

                    <div class="weui-btn-area" id="saveadd">
                        <a class="weui-btn btn-default" href="javascript:" id="showTooltips" style="background:#fc560b">保存</a>
                    </div>
                </div>
                <!--END user_address_add-->

            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        document.title='添加地址';
        //添加地址选择区域
        $("#changeArea").click(function () {
            choose.area();
            choose.callBack=function (area) {
                $("#myarea").text(area.fullName);
                $("#myarea").attr('area-id',area.id); //绑定区域id
            };
        });

        //保存地址
        $("#saveadd").click(function(){
            var consignee=$("#consignee").val();
            var phone=$("#phone").val();
            var address=$("#address").val();
            var areaId=$("#myarea").attr('area-id');
            if(consignee==""){
                dialog.show("请输入收货人姓名！")
            }else if((!(/^1[34578]\d{9}$/.test(phone)))){
                dialog.show("请输正确手机号码！")
            }else if($("#myarea").val()==''){
                dialog.show("请选择收货地址！")
            }else{
                var re=new receiver(function(data){
                    console.log(data);
                    toast.show("添加成功");
                    setTimeout(function(){
                        pageManager.back();
                    },1000);

                });
                re.save({consignee:consignee,phone:phone,address:address,areaId:areaId});
            }
        });
    });


</script>
</script>
<script type="text/html" id="tpl_edit-address">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    
<div class="chooseWidget weui-tab__panel" style="width:100%;background: #FFFFFF;position: fixed;z-index: 1000;display: none;">
</div>

    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab" style="background: #f8f8f8">
            <div class="weui-tab__panel">

                <!--BEGIN user_address_add-->
                <div class="myaddressadd">

                    <div class="weui-cells weui-cells_form" style="margin-top:0">
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">收货人</label></div>
                            <div class="weui-cell__bd f14">
                                <input class="weui-input" type="text" placeholder="请输入收货姓名" id="consignee"/>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cells weui-cells_form">
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">联系方式</label></div>
                            <div class="weui-cell__bd f14">
                                <input class="weui-input" maxlength="11" type="number" pattern="[0-9]*" placeholder="请输入11位收货电话号" id="phone"/>
                            </div>
                        </div>
                    </div>
                    <div class="weui-cells weui-cells_form">
                        <div class="weui-cell" id="changeArea" >
                            <div class="weui-cell__hd f14"><label class="weui-label">所在地区</label></div>
                            <div class="weui-cell__bd f14">
                                <span id="myarea"></span>
                            </div>
                            <div class="weui-cell__ft">
                                <i class="icon iconfont icon-right-01"></i>
                            </div>
                        </div>
                    </div>

                    <div class="weui-cells weui-cells_form">
                        <div class="weui-cell">
                            <div class="weui-cell__hd f14"><label class="weui-label">详细地址</label></div>
                            <div class="weui-cell__bd f14">
                                <input class="weui-input" type="text" placeholder="请输入详细地址" id="address"/>
                            </div>
                        </div>
                    </div>

                    <div class="weui-btn-area" id="saveadd">
                        <a class="weui-btn btn-default" href="javascript:" id="showTooltips" style="background:#fc560b">保存</a>
                    </div>
                </div>
                <!--END user_address_add-->

            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        document.title='编辑地址';

        var id=pageManager.GetQueryString('id');
        var re=new receiver(function(data){
                $("#consignee").val(data.consignee);
                $("#myarea").html(data.area.fullName);
                $("#myarea").attr('area-id',data.area.id)
                $("#address").val(data.address);
                $("#phone").val(data.phone);
        });
        re.view({id:id});


        //添加地址选择区域
        $("#changeArea").click(function () {
            choose.area();
            choose.callBack=function (area) {
                $("#myarea").text(area.fullName);
                $("#myarea").attr('area-id',area.id); //绑定区域id
            };
        });

        //保存修改好的地址
        $("#saveadd").click(function(){
            var area_id=$("#myarea").attr('area-id');
            var consignee=$("#consignee").val();
            var address=$("#address").val();
            var phone=$("#phone").val();
            var re=new receiver(function(data){
                console.log(data);
                toast.show("修改成功");
                setTimeout(function () {
                   pageManager.back();
                },1000);
            });
            re.update({id:id,areaId:area_id,consignee:consignee,address:address,phone:phone});
        });
    });


</script>
</script>

<!--我的订单列表-->
<script type="text/html" id="tpl_order-list">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd tabBer row" style="height: 94%;">
        <div class="vux-tab">
            <div class="vux-tab-item vux-center f14 selected shop_img all" otype="all" onclick="loadUpFn('all')"><span class="tab_nav">全部</span></div>
            <p class="vux-tab-ink-bar vux-tab-ink-bar-transition-forward" id="bor" style=" left: 0; right: 80%;display: none;"></p>
            <div class="vux-tab-item vux-center f14 shop_img unpaid" otype="unpaid"  onclick="loadUpFn('unpaid')"><span class="tab_nav">待支付<span  id="ounpaid"></span></span></div>
            <p class="vux-tab-ink-bar vux-tab-ink-bar-transition-forward" id="bor" style=" left: 20%; right: 60%;display: none;"></p>
            <div class="vux-tab-item vux-center f14 shop_img unshipped" otype="unshipped" onclick="loadUpFn('unshipped')"><span class="tab_nav">待发货<span id="ounshipped"></span></span></div>
            <p class="vux-tab-ink-bar vux-tab-ink-bar-transition-forward" id="bor" style=" left: 40%; right: 40%;display: none;"></p>
            <div class="vux-tab-item vux-center f14 shop_img unreciver"  otype="unreciver" onclick="loadUpFn('unreciver')"><span class="tab_nav">待收货<span  id="ounreciver"></span></span></div>
            <p class="vux-tab-ink-bar vux-tab-ink-bar-transition-forward" id="bor" style=" left: 60%; right: 20%;display: none;"></p>
            <div class="vux-tab-item vux-center f14 shop_img unreview"  otype="unreview" onclick="loadUpFn('unreview')"><span class="tab_nav">待评价<span  id="ounreview"></span></span></div>
            <p class="vux-tab-ink-bar vux-tab-ink-bar-transition-forward" id="bor" style=" left: 80%; right: 0;display: none;"></p>
        </div>
        <div class="weui-tab" style="padding-top:45px;">
            <div class="weui-tab__panel pageable">
                <div class="vux-slider">

                    <div class="vux-swiper " style="background:#f8f8f8;">
                        <div class="vux-swiper-item orderd"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">



    var type = pageManager.GetQueryString('type');
    var thistype=$('.'+type);
    thistype.next('p').show().siblings('p').hide();

    var jsonsData = {
        pageSize: 10,
        pageNumber: 1,
        type: type ? type : 'all'
    };
    var pge;


    var loadUpFn = function (type) {
        if (type) jsonsData.type = type;
        pge.refresh();
    };

    $(function () {

        if(localStorage.getItem('refreshed') !== 'true') {
            setTimeout(function(){
                window.location.reload();
            },0);
            return localStorage.setItem('refreshed', 'true');
        }
        localStorage.setItem('refreshed', 'false');

        document.title='我的订单';
        //切换加载数据
        pge = $(".pageable").pageable({
            loadUpFn: function (me) {
                var tu = new order(function (data) {
                    jsonsData.pageNumber = jsonsData.pageNumber + 1;
                    var h = render.fill($("#tpl_orderst"), data);
                    $(".pageable .orderd").html(h);
                    pge.resetload();
                });
                jsonsData.pageNumber = 1;
                tu.list(jsonsData);
            },

            loadDownFn: function (me) {
                console.log("loadDownFn");
                console.log(jsonsData);
                var td = new order(function (data) {
                    jsonsData.pageNumber = jsonsData.pageNumber + 1;
                    var h = render.fill($("#tpl_orderst"), data);
                    $(".pageable .orderd").append(h);
                    if (data.length < jsonsData.pageSize) {
                        pge.lock();
                        pge.noData();
                    }
                    pge.resetload();
                });
                td.list(jsonsData);
            }
        });


        $('.vux-tab .vux-tab-item').on('click',function () {
            $(this).next('p').show().siblings('p').hide();
            var otype=$(this).attr('otype');
            console.log(otype);
            var state = {
                title: "title",
                url: "member-home.html?type="+otype+"#order-list"
            };
            window.history.pushState(state,"title","member-home.html?type="+otype+"#order-list");
        });

        //控制我的订单中角标数量显示
        var mem = new member(function (data) {
            //待支付
            if (data.unpaid == 0) {
                $("#ounpaid").css("display", 'none');
            } else {
                $("#ounpaid").html(data.unpaid);
                $("#ounpaid").addClass('badge');
            }
            //待发货
            if (data.unshipped == 0) {
                $("#ounshipped").css("display", 'none');
            } else {
                $("#ounshipped").html(data.unshipped);
                $("#ounshipped").addClass('badge');
            }
            //待收货
            if (data.unreciver == 0) {
                $("#ounreciver").css("display", 'none');
            } else {
                $("#ounreciver").html(data.unreciver);
                $("#ounreciver").addClass('badge');
            }
            //待评价
            if (data.unreview == 0) {
                $("#ounreview").css("display", 'none');
            } else {
                $("#ounreview").html(data.unreview);
                $("#ounreview").addClass('badge');
            }
        });
        mem.index();



        pushHistory();
        var bool=false;
        setTimeout(function(){
            bool=true;
        },100);
        window.addEventListener("popstate", function(e) {
            if(bool)
            {
               location.href='member-home.html';
            }
            pushHistory();

        }, false);
        function pushHistory() {
            var state = {
                title: "title",
                url: ""
            };
            window.history.pushState(state,"title","");
        }



    });
</script>

</script>
<!--订单详情-->
<script type="text/html" id="tpl_orderDetail">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel">
                <div class="qwerty"></div>
                <div class="getcode" style="z-index: 5000;">
                    <i class="icon iconfont icon-remove-02" style="float:right;margin-right: 10px;"></i>
                    <div class="ewm">
                        <img src="" alt="" id="qCrode">
                    </div>
                    <p>提货码</p>
                </div>
                <div class="weui-mask" id="iosMask" style="display: none"></div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        document.title='订单详情';


        var od = new order(function (data) {
            console.log(data.pickUpCode);
            var qcrode=data.pickUpCode;
            //第三方二维码生成器
            var src='http://qr.liantu.com/api.php?text='+qcrode;
            $('#qCrode').attr('src',src);
            var h = render.fill($("#tpl_orderDetailLogs"), data);
            $(".qwerty").html(h);
            $(document).on("click",".shangpin",function (){
                var daid = $(this).attr('id');
                if(data.orderItems[0].productId == null){
                    toast.show('此商品已删除！');
                }else if(data.orderItems[0].marketable == false){
                    toast.show('此商品已下架！');
                }else{
                    window.location.href="../product/product-details.html?id=" + daid;
                }
            });
        });
        od.view({id:pageManager.GetQueryString("id")});

        var $mask=$("#iosMask");
        
        $('.getcode .icon-remove-02').on('click',function () {
            $mask.fadeOut();
            $('.getcode').hide();
        });
        $mask.on('click',function () {
            $mask.fadeOut();
            $('.getcode').hide();
        });


    });
</script>

</script>
<!--订单评价-->
<script type="text/html" id="tpl_evaluate">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel" style="padding-bottom: 10vw;">
                <!--BEGIN evaluateorder-->
                <div class="evaluateorder orderEvalute"></div>
                <!--END evaluateorder-->
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function(){
        document.title='订单评价';

        var od = new review(function (data) {
            console.log(data);
            var h = render.fill($("#tpl_evaluateOrders"), data);
            $(".orderEvalute").html(h);
        });
        od.view({tradeId:pageManager.GetQueryString("id")});
    })



</script>


</script>


<!--我的推广-->
<script type="text/html" id="tpl_promoting-index">
<div class="page">
    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel">
                <!--BEGIN user_spread-->
                <div class="user_spread" page="1">
                    <div class="section1">
                        <span class="line"></span><span class="text f12">推广分润</span><span class="line"></span>
                        <p style="vertical-align:middle;"><span class="f24 money">0</span>元</p>

                        <p class="f14 orange">我已成功邀请：<span class="f20 man">0</span><span>人</span></p>
                        <p class="f12 text" id="reMend"><span>我的推荐人:</span><span id="remendman"></span></p>
                    </div>
                    <div class="section2">
                        <img src="../images/static/tuiguang1.png" alt="">
                        <p class="f14">邀请TA一起逛遍同城好店</p>
                        <p class="f12"><a href="javascript:pageManager.go('promoting-detailed');">查看分润规则></a></p>
                        <a href="javascript:;" class="weui-btn weui-btn_default" id="showIOSActionSheet" style="color:#fff" onclick="document.getElementById('mcover').style.display='block';">邀请好友</a>
                    </div>
                    <div class="section3">
                        <i class="icon iconfont icon-orc"></i>
                    </div>
                    <div class="section4" style="z-index: 5000">
                        <i class="icon iconfont icon-remove-02" style="float:right;margin-right: 10px;"></i>
                        <div class="ewm">
                            <img src="http://dev.ruishangquan.com/weixin/member/qrcode.jhtml" alt="">
                        </div>
                        <p>扫一扫成为本店会员</p>
                    </div>
                    <div id="mcover" onclick="document.getElementById('mcover').style.display='';" style="display: none;">
                        <img src="../images/static/guide1.png">
                    </div>
                    <div class="weui-mask" id="iosMask2" style="display: none"></div>
                </div>

                <!--end user_spread-->
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(function(){
        document.title='我的推广';

        var $iosMask2 = $('#iosMask2');
        function hideActionSheet2(){
            $iosMask2.fadeOut(200);
            $(".saoma").css("display","none");
            $(".section4").css("display","none");
        }
        $iosMask2.on('click', hideActionSheet2);


        $(".section3").click(function(){
            $(".section4").css("display",'block');
            $iosMask2.fadeIn(200);
        });

        $(".icon-remove-02").click(function(){
            $(".section4").css("display",'none');
            $(".section1").css("background","#fff");
            $iosMask2.fadeOut(200);
        });
        var me =new member(function(data){
            console.log(data);
            if(data.username!=''){
                $('#reMend').show();
                $('#remendman').html(data.username);
            }else if(data.username==''){
                $('#reMend').hide();
            }
            $('.man').html(data.count);
            $('.money').html(data.rebate);
            var imgUrl=data.imgUrl;
            var title=data.title;
            var link=data.link;
            var desc=data.desc;
            //分享功能
            weixin.share({
                title:title,
                desc:desc,
                link:link,
                imgUrl:imgUrl
            })
        });
        me.extension();
    });
</script>
</script>
<script type="text/html" id="tpl_promoting-detailed">
<div class="page">
    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <div class="weui-tab__panel">
                <!--BEGIN myspreadru-->
                <div class="user_spread_rules" page="1">
                    <article class="weui-article">
                        <h1>挑货网平台推广协议</h1>
                        <section>
                            <p>
                                关于消费者：您邀请好友注册挑货网平台后，好友在挑货网的每笔消费您都可以实时获得分润佣金哦，根据商家设置的商品分润佣金不同，您得到的分润佣金也会对应比例的会有所不同。获得的分润佣金不仅可以继续在挑货网平台消费，同时还可以提现，可以提现，可以提现，重要的事情要说三遍。 关于店主：通过本店导购发展的挑货网平台用户，其在挑货网的每笔消费会按比例发放给您和发展该用户的导购。 关于导购：您发展的每位挑货网平台用户，其在挑货网的每笔消费您都可以实时获得分润佣金哦。</p>
                        </section>

                    </article>
                </div>
                <!--END myspreadru-->
            </div>
        </div>
    </div>
</div>
<script>
    $(function () {
        document.title='分润细则';
    })
</script>
</script>
<!--我要开店-->
<script type="text/html" id="tpl_openshop">
<div class="page">
    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <!--BEGIN openshop-->
            <div class="openshop">
                <div class="section1">
                    <h2>挑货网手机app</h2>
                    <h6 class="f14">让你轻轻松松逛遍实体店</h6>
                    <p class="f16"><a href="javascript:pageManager.go('openshop_up');">立即开店</a></p>
                    <img src="../images/static/openshop2.png" alt="">
                    <img src="../images/static/openshop3.png" alt="" >
                    <h2>挑货网手机app</h2>
                    <h6 class="f14">让你轻轻松松逛遍实体店</h6>
                    <p class="f16"><a href="javascript:pageManager.go('openshop_up');">立即开店</a></p>
                </div>
            </div>
            <!--END openshop-->
        </div>
    </div>
</div>
<script>
    $(function(){
        document.title='我要开店';
    })
</script>


</script>
<script type="text/html" id="tpl_openshop_up">
<div class="page">
    

    <!--BEGIN toast-->
    <div id="toast" style="display: none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <i class="weui-icon-info-circle weui-icon_toast"></i>
            <p class="weui-toast__content">已完成</p>
        </div>
    </div>
    <!--end toast-->

    <!-- loading toast -->
    <div id="loadingToast" style="display:none;">
        <div class="weui-mask_transparent"></div>
        <div class="weui-toast">
            <!--<i class="weui-loading weui-icon_toast"></i>-->
            <p class="weui-toast__content">努力加载</p>
        </div>
    </div>


    

    <!--BEGIN dialog1-->
    <div id="dialog1" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__hd"><strong class="weui-dialog__title">操作提示</strong></div>
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_default">否</a>
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">是</a>
            </div>
        </div>
    </div>
    <!--END dialog1-->
    <!--BEGIN dialog2-->
    <div id="dialog2" style="display: none;">
        <div class="weui-mask"></div>
        <div class="weui-dialog">
            <div class="weui-dialog__bd">弹窗内容，告知当前状态、信息和解决方法，描述文字尽量控制在三行内</div>
            <div class="weui-dialog__ft">
                <a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">知道了</a>
            </div>
        </div>
    </div>
    <!--END dialog2-->


    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <!--BEGIN openshop_up-->
            <div class="openshop_up">
                <div class="background">
                    <img src="../images/static/openshop_up.png" alt="">
                    <div class="upload">
                        <p><a href="javascript:;" id="openIos"><img src="../images/static/openshop_apple.png" alt=""></a></p>
                        <p><a href="javascript:;" id="openAndroid"><img src="../images/static/openshop_androide.png" alt=""></a></p>
                    </div>
                </div>
            </div>
            <!--END openshop_up-->
        </div>
    </div>
</div>
<script>
    $(function () {
        document.title='立即开店';

        //我要开店后跳转链接并下载
        document.getElementById('openAndroid').onclick=document.getElementById('openIos').onclick = function(e) {
            var ua = window.navigator.userAgent.toLowerCase();
            if (ua.match(/MicroMessenger/i) == 'micromessenger') {
                dialog.show("点击右上角“···”其他浏览器打开进行下载！");
            } else {
                if (navigator.userAgent.match(/(iPhone|iPod|iPad);?/i)) {
//                    window.location.href = "com.baidu.tieba://";//ios app协议
                    window.setTimeout(function () {
                        window.location.href = "http://itunes.apple.com/cn/app/id1067224099?mt=8";
                    }, 2000)
                }
                if (navigator.userAgent.match(/android/i)) {
//                    window.location.href = "com.baidu.tieba://app";//android app协议
                    window.setTimeout(function () {
                        window.location.href = "http://oss.rzico.com/update/helper/helper-release.apk";//android 下载地址
                    }, 2000)
                }
            }
        }
    });
</script>
</script>
<!--意见反馈-->
<script type="text/html" id="tpl_feedback">
<div class="page">
    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab" style="background: #fff;">
            <!--BEGIN feedback-->
            <div class="feedback">
                <div class="section1">
                    <img src="../images/static/feedbackph.png" alt="">
                </div>
                <div class="section2 f16">
                    <p>您在使用中有任何疑问，欢迎致电:</p>
                    <p><a href="tel://0551-67698098">0556-5058901</a></p>
                </div>
            </div>
            <!--END feedback-->

        </div>
    </div>
</div>
<script>
    $(function () {
        document.title='意见反馈';
    })
</script>
</script>
<!--关于我们-->
<script type="text/html" id="tpl_about">
<div class="page">
    <div class="page__bd" style="height: 100%;">
        <div class="weui-tab">
            <!--BEGIN aboutus-->
            <div class="aboutus">
                <div class="section1">
                    <img src="../images/static/jd_logo.png" alt="">
                </div>

                <div class="weui-cells">
                    <div class="weui-cell">
                        <div class="weui-cell__bd weui-cell__primary f14">
                            <p>微信公众号</p>
                        </div>
                        <div class="weui-cell__ft f14" style="color:#000">
                            聚德汇
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__bd weui-cell__primary f14">
                            <p>聚德汇</p>
                        </div>
                        <div class="weui-cell__ft f14" style="color:#000">
                            jdhone.com
                        </div>
                    </div>
                    <div class="weui-cell">
                        <div class="weui-cell__bd weui-cell__primary f14">
                            <p>当前版本号</p>
                        </div>
                        <div class="weui-cell__ft f14" style="color:#000">
                            1.0.0
                        </div>
                    </div>
                </div>

                <div class="section2 f14">
                    <p>2016-2018 jdhone.com</p>
                </div>
            </div>
            <!--END aboutus-->
        </div>
    </div>
</div>
<script>
    $(function () {
        document.title='关于我们';
    })
</script>
</script>


<!---------------模版---------------------------------------->
<!--优惠券-->
<script type="text/html" id="tpl_coupon">
<!--coupon-->
{{#each this}}
    {{#compare type '==' 'multipleCoupon'}}
        <div class="cou row">
            <a href="../member/platformTicket.html?id={{id}}">
                <div class="col-8">
                    <img src="../images/static/coupon.png" alt=""><span class="denomination f16">￥{{amount}}</span><span class="price f14">无门槛使用</span>
                </div>
                <div class="col-15">
                    <p class="Ftitle">挑货网平台券</p>
                </div>
            </a>
        </div>
    {{/compare}}
{{/each}}

{{#each this}}
    {{#compare type '==' 'tenantCoupon'}}
            <div class="row">
                <div class="col-8">
                    {{#if used}}<img src="../images/static/yhqbg-2.png" alt=""><span class="denomination f16">￥{{amount}}</span><span class="price f14">满{{minimumPrice}}可用</span><img src="../images/static/ysy.png" alt="">{{else}}<img src="../images/static/yhqbg.png" alt=""><span class="denomination f16">￥{{amount}}</span><span class="price f14">满{{minimumPrice}}可用</span>{{/if}}
                </div>
                <div class="col-15">
                    <p class="Ftitle">{{tenantName}}</p>
                    <p class="Fauxiliary">有限期至:{{endDate}}</p>
                </div>
            </div>
    {{/compare}}
{{/each}}


<!--coupon end-->


</script>

<!--银行卡-->
<script type="text/html" id="tpl_bankcard">


<!--我的银行卡模板-->
{{#if this}}
{{#each this}}
<div class="weui-cell" id={{id}}>
    <div class="weui-cell__hd" style="width:20vw;height:20vw">
        {{#compare logo '!=' null}}
        <img src="{{logo}}" />
        {{/compare}}
        {{#compare logo '==' null}}
        <img src="../images/placeholder/product.png" />
        {{/compare}}
    </div>
    <div class="weui-cell__bd weui-cell__primary" style="padding-left: 5vw">
        <p class="f14">{{bankName}}</p>
        {{#if type}}
        {{#compare type '==' 'debit'}}
        <p class="f14">储蓄卡</p>
        {{/compare}}
        {{#compare type '==' 'credit'}}
        <p class="f14">信用卡</p>
        {{/compare}}
        {{/if}}
        <p class="f14">**** **** ****<span>&nbsp;{{cardNo}}</span><span>{{account}}</span></p>
    </div>
    <div class="weui-cell__ft">
        <p class="deletecard f12"><span><i class="icon iconfont icon-delete-01"></i>删除</span></p>
    </div>
</div>
{{/each}}
{{else}}
<div class="cartEmpty">
    <i class="icon iconfont icon-creditcard"></i>
    <p>亲还没有银行卡哦!快去添加吧！</p>
</div>
{{/if}}



<script>
    $(function(){

        //删除银行卡
        $(".deletecard").click(function() {
            var cardid = $(this).parent().parent().attr("id");
            dialog.query("您确认删除该银行卡吗？", function () {
                var ba = new bank(function (data) {
                    console.log(data);
                    dialog.show("删除成功");
                    setTimeout(function () {
                        location.reload();
                    }, 1000);
                });
                ba.delete({id: cardid});
            })
        })
    });
</script>
</script>
<!--账单详细-->
<script type="text/html" id="tpl_bills">

<!--账单明细模板-->


{{#each this}}
<div class="weui-cell ">
    <div class="weui-cell__hd f14">
        {{#if type}}
            {{#compare type '==' 'recharge'}}
            <p>充值</p>
            {{/compare}}
            {{#compare type '==' 'payment'}}
            <p>购物</p>
            {{/compare}}
            {{#compare type '==' 'withdraw'}}
            <p>贷款</p>
            {{/compare}}
            {{#compare type '==' 'receipts'}}
            <p>分润</p>
            {{/compare}}
            {{#compare type '==' 'profit'}}
            <p>佣金</p>
            {{/compare}}
            {{#compare type '==' 'rebate'}}
            <p>收款</p>
            {{/compare}}
            {{#compare type '==' 'rebate'}}
            <p>收款</p>
            {{/compare}}
            {{#compare type '==' 'cashier'}}
            <p>其他</p>
            {{/compare}}
            {{#compare type '==' 'income'}}
            <p>其他</p>
            {{/compare}}
            {{#compare type '==' 'outcome'}}
            <p>红包</p>
            {{/compare}}
            {{#compare type '==' 'coupon'}}
            <p>红包</p>
            {{/compare}}
        {{/if}}
    </div>
    <div class="weui-cell__bd weui-cell__primary f12">
        <p>{{memo}}</p>
        <p>{{create_date}}</p>
    </div>
    <div class="weui-cell__ft f12">
        {{#if credit}}
        {{#compare credit '>' 0}}
        <p>+￥{{credit}}</p>
        {{/compare}}
        {{#compare credit '<' 0}}
        <p>-￥{{credit}}</p>
        {{/compare}}
        {{/if}}

        {{#if debit}}
        {{#compare debit '>' 0}}
        <p>-￥{{debit}}</p>
        {{/compare}}
        {{#compare debit '<' 0}}
        <p>-￥{{debit}}</p>
        {{/compare}}
        {{/if}}

        <p>￥{{balance}}</p>
    </div>
</div>
{{/each}}
</script>
<!--收藏商家-->
<script type="text/html" id="tpl_collectshop">
<!--收藏店铺模板-->
{{#each this}}
<a href="../tenant/tenant-home.html?id={{id}}" class="weui-cell" tenant-id={{id}}>

    <div class="weui-cell__hd">
        {{#compare thumbnail '!=' null}}
        <img src="{{thumbnail}}" />
        {{/compare}}
        {{#compare thumbnail '==' null}}
        <img src="../images/placeholder/tenant.png" />
        {{/compare}}
    </div>
    <div class="weui-cell__bd">
        <p class="Ftitle">{{name}}</p>
        <div class="weui-flex">
            <div class="weui-flex__item Ftext">主营：<span>{{tenantCategoryName}}</span></div>
        </div>
        <div class="border-top">
            <div class="weui-cell">
                <div class="weui-cell__bd Fauxiliary" style="margin-left:-1.5vw;">{{address}}</div>
                <div class="weui-cell__ft Fauxiliary">{{#ifcond distance -1}}{{distance}}km{{else}}{{/ifcond}}<i class="icon iconfont icon-s-location"></i></div>
            </div>
        </div>
    </div>
</a>
{{/each}}
</script>


<!--地址列表-->
<script type="text/html" id="tpl_address">

<!--获取我的地址模板-->
{{#if this}}
{{#each this}}
<div class="weui-cells weui-cells_radio weui-cells_checkbox" ad-id={{id}}>
    <div class="address_item">
        <p class="f14"><span>{{consignee}}</span><span>{{phone}}</span></p>
        <p class="Fauxiliary" area-id={{area.id}}>{{area.fullName}}{{address}}</p>
    </div>
    <label class="weui-cell weui-check__label" for='x{{id}}'>
        <div class="weui-cell__ft f14">
            {{#if isDefault}}
            <input type="radio" class="weui-check ifcheck" name="radio1" id='x{{id}}' checked>
            {{else}}
            <input type="radio" class="weui-check ifcheck" name="radio1" id='x{{id}}'>
            {{/if}}
            <i class="weui-icon-checked"></i>
        </div>
        <div class="weui-cell__bd">
            <p class="f12">默认地址</p>
        </div>
    </label>
    <p class="edit f12"><span class="editad"><i class="icon iconfont icon-bianji"></i>编辑</span><span class="deletead"><i class="icon iconfont icon-delete-01"></i>删除</span></p>
</div>
{{/each}}
{{else}}
<div class="cartEmpty">
    <i class="icon iconfont icon-home"></i>
    <p>亲还没有收获地址哦!快去添加吧！</p>
</div>
{{/if}}


<script>
    $(function(){


        //删除收货地址
        $(".deletead").click(function(){
        var ad_id=$(this).parent().parent().attr('ad-id');
            dialog.query("您确认删除该地址吗？",function () {
                var re=new receiver(function(data){
                    console.log(data);
                    toast.show("删除成功");
                    setTimeout(function () {
                        location.reload();
                    },500);
                });
                re.delete({id:ad_id});
            });
        });


        //设为默认地址
        $("label").click(function(){
            var ad_id=$(this).parent().attr('ad-id');
            var re=new receiver(function(data){
                console.log(data);
                toast.show("设置成功");
                setTimeout(function () {
                    location.reload();
                },200);
            });
            re.setDefault({id:ad_id});
        });


        var $firstDefalut=$('.weui-cells').first();
        var id=$firstDefalut.attr('ad-id');
        var r=new receiver(function (data) {
            console.log(data);
            $('.weui-cells').first().find('.ifcheck').prop('checked',true);
        });
        r.setDefault({id:id});


        var ad_id;
        //点击编辑地址
        $(".editad").click(function(){
            ad_id=$(this).parent().parent().attr('ad-id');
            var re=new receiver(function(data){
                console.log(data.area.id);
                location.href=location.origin+'/weixin/member/member-home.html?id='+ad_id+'#edit-address';
            });
            re.view({id:ad_id});
        });



    });
</script>
</script>
<!--我的订单列表-->
<script type="text/html" id="tpl_orderst">
{{#each this}}
<div class="weui-cells Details">
    <div onclick="location.href='member-home.html?id={{id}}#orderDetail'">
        <a class="weui-cell" data-id="{{id}}">
            <div class="weui-cell__hd shop_icon">
                <img src="{{tenantThumbnail}}" alt="">
            </div>
            <div class="weui-cell__bd Ftitle">{{tenantName}}</div>
            {{#compare shippingMethod.id '==' 1}}
            <div class="weui-cell__ft state f12">{{finalOrderStatus.desc}}</div>
            {{/compare}}
            {{#compare shippingMethod.id '==' 3}}
            <div class="weui-cell__ft state f12">(到店提货){{finalOrderStatus.desc}}</div>
            {{/compare}}
        </a>
        {{#with orderItems}}
        {{#each this}}
        <a class="weui-cell" data-id="{{id}}" href="javascript:;">
            <div class="weui-cell__hd  product_img">
                <img src="{{thumbnail}}"/>
            </div>
            <div class="weui-cell__bd product-txt">
                <p class="Ftitle">{{fullName}}</p>
                <p class="Fauxiliary">订单号:{{../../sn}}</p>
                <p  class="price f14">￥{{price}}</p>
                {{#if promotions}}
                    {{#with promotions}}
                        <div class="border-top Fauxiliary">
                            {{#each this}}
                            <div class="f12"><i class="iconfont icon-{{type}} tenant_i fl"></i>{{name}}</div>
                            {{/each}}
                        </div>
                    {{/with}}
                {{/if}}


            </div>
            <div class="weui-cell__ft f12 qty">x {{quantity}}</div>
        </a>
        {{/each}}
        {{/with}}
    </div>
    <div class="tr f12">
        <span>共<span class="orange">{{quantity}}</span>件商品</span> <span class="ml20">实付款<span class="orange">￥{{amount}}</span></span><span class="ml20">(含运费<span>￥{{freight}})</span></span>
    </div>
    {{#if finalOrderStatus}}
    <div class="btns" order-id="{{id}}">

        {{#compare finalOrderStatus.status '==' 'unconfirmed'}}
        <a href="javascript:;" class="btn-gray closeod">取消订单</a>
        {{/compare}}

        {{#compare finalOrderStatus.status '==' 'waitPay'}}
        <a href="javascript:;" class="btn-gray closeod">取消订单</a>
        <a href="javascript:;" class="btn-actvie payod">立即支付</a>
        {{/compare}}
        {{#compare finalOrderStatus.status '==' 'waitShipping' }}
        {{#compare ../shippingMethod.id '==' 1}}
        <a href="javascript:;" class="btn-gray backod">退货申请</a>
        <a href="javascript:;" class="btn-actvie alertod">提醒商家发货</a>
        {{/compare}}
        {{#compare ../shippingMethod.id '==' 3}}
        <a href="javascript:;" class="btn-gray backod">退货申请</a>
        {{/compare}}
        {{/compare}}
        {{#compare finalOrderStatus.status '==' 'sign'}}
        <a href="javascript:;" class="btn-gray backod">退货</a>
        {{#with shippings}}
        {{#each this}}
            <a href="https://m.kuaidi100.com/result.jsp?nu={{trackingNo}}" class="btn-gray logistics">查看物流</a>
        <a href="https://m.kuaidi100.com/result.jsp?nu={{trackingNo}}" class="btn-gray logistics">查看物流1</a>
        {{/each}}
        {{/with}}

        <a href="javascript:;" class="btn-actvie signod">立即签收</a>
        {{/compare}}
        {{#compare finalOrderStatus.status '==' 'toReview'}}
        <a  data-id="{{id}}" class="btn-actvie reviewod">立即评价</a>
        {{/compare}}
        {{#compare finalOrderStatus.status '==' 'waitReturn'}}
        <a href="javascript:;" class="btn-gray getmoneyod">提醒商家退款</a>
        {{/compare}}
    </div>
    {{/if}}
    <div class="kong"></div>
</div>

{{/each}}

<script>

    //订单页角标的更新
    function badgeCount() {
        var mem = new member(function (data) {
            //待支付
            if (data.unpaid == 0) {
                $("#ounpaid").css("display", 'none');
            } else {
                $("#ounpaid").html(data.unpaid);
            }
            //待发货
            if (data.unshipped == 0) {
                $("#ounshipped").css("display", 'none');
            } else {
                $("#ounshipped").html(data.unshipped);
            }
            //待收货
            if (data.unreciver == 0) {
                $("#ounreciver").css("display", 'none');
            } else {
                $("#ounreciver").html(data.unreciver);
            }
            //待评价
            if (data.unreview == 0) {
                $("#ounreview").css("display", 'none');
            } else {
                $("#ounreview").html(data.unreview);
            }
        });
        mem.index();
    }
    badgeCount();
    $(function(){

        //查看物流显示第一个
        $('.logistics').each(function () {
            var index=$(this).index();
            if(index>1){
                $(this).remove();
            }
        });

        //取消订单
        $('.closeod').die().live('click',function () {
            var $this=$(this);
            var od_id;
            od_id=$(this).parent().attr('order-id');
            dialog.query("您确认取消该订单吗？",function(){
                var or=new order(function(data){
                    console.log(data);
                    setTimeout(function () {
                        $this.parent().parent().remove();
                        badgeCount();
                    },500);
                });
                or.refund({id:od_id})
            });
        });

        //立即评价跳转
        $('.reviewod').on('click',function () {
            var ev=$(this).parent().attr('order-id');
            location.href=location.origin+'/weixin/member/member-home.html?id='+ev+'#evaluate';
        });


        //提醒卖家发货
        $('.alertod').die().live('click',function () {
            var od_id=$(this).parent().attr('order-id');
            var or=new order(function(data){
                console.log(data);
                dialog.show("提醒成功")
            });
            or.remind({id:od_id})
        });


        //签收订单
        $('.signod').die().live('click',function () {
            var $this=$(this);
            var od_id;
            od_id=$(this).parent().attr('order-id');
            dialog.query("您确认签收该订单吗？",function () {
                var or=new order(function(data){
                    console.log(data);
                    setTimeout(function () {
                        dialog.show("签收成功");
                        badgeCount();
                        $this.parent().parent().remove();
                        location.reload();
                        location.href=location.origin+'/weixin/member/member-home.html?id='+od_id+'#evaluate'
                    },500);
                });
                or.confirm({id:od_id})
            })
        });

        //申请退货
        $('.backod').die().live('click',function () {
            var $this=$(this);
            var od_id;
            od_id=$(this).parent().attr('order-id');
            dialog.query("您确认申请退货吗？",function () {
                var or=new order(function(data){
                    console.log(data);
                    setTimeout(function () {
                        dialog.show("申请成功");
                        location.reload();
                        badgeCount();
                    },500);
                });
                or.return({id:od_id});
            })
        });

        //立即支付订单
        $('.payod').die().live('click',function () {
            var order_id;
            order_id=$(this).parent().attr('order-id');
            var od=new order(function(data){
                location.href=location.origin+'/weixin/payment/orderPayment.html?sn='+data;
            });
            od.tradePayment({id:order_id});
        });

        //提醒商家退货
        $('.getmoneyod').die().live('click',function () {
            var od_id=$(this).parent().attr('order-id');
            var or=new order(function(data){
                console.log(data);
                dialog.show("提醒成功")
            });
            or.remind({id:od_id})
        })

    })
</script>

</script>
<!--我的订单详情列表-->
<script type="text/html" id="tpl_orderDetailLogs">
<!-- orderdetail-->
<div class="orderdetail">
    <div class="weui-cells status mainback">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p class="f14">交易状态</p>
            </div>
            <div class="weui-cell__ft">
                <p class="f12">{{finalOrderStatus.desc}}</p>
            </div>
        </div>
    </div>
    <div class="weui-cells detail row">
        {{#each orderLogs}}
        <div class="col-2">
            <div class="line"></div>
            <div class="circle"><i class="icon iconfont icon-shangjiantou"></i> </div>
        </div>
        <div class="col-22">
            <div class="weui-cell">
                <div class="weui-cell__bd">
                    <p class="f12">{{content}}</p>
                    <p class="Fauxiliary">{{content}}</p>
                </div>
                <div class="weui-cell__ft">
                    <p class="Fauxiliary">{{createDate}}</p>
                </div>
            </div>
        </div>
        {{/each}}
    </div>
    <div class="weui-cells status mainback">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p class="f14">订单信息</p>
            </div>
        </div>
    </div>
    <div class="weui-cells detailsd" >
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p class="f12">支付方式</p>
            </div>
            <div class="weui-cell__ft weui-cell_primary f12" >{{paymentMethod.name}}</div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p class="f12">配送方式</p>
            </div>
            <div class="weui-cell__ft weui-cell_primary f12" >{{shippingMethod.name}}</div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p class="f12">订单号</p>
            </div>
            <div class="weui-cell__ft weui-cell_primary f12"><a href="javascript:" style="color: #999">{{sn}}</a></div>
        </div>
        {{#with shippings}}
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p class="f12">快递单号</p>
            </div>
            {{#each this}}
            <div class="weui-cell__ft weui-cell_primary f12"><a href="javascript:" style="color: #999">{{deliveryCorp}}{{trackingNo}}</a></div>
            {{/each}}
        </div>
        {{/with}}
        {{#compare shippingMethod.id '==' '3'}}
        <div class="weui-cell" id="Gcode">
            <div class="weui-cell__bd" >
                <p class="f12">提货码</p>
            </div>
            <div class="weui-cell__ft weui-cell_primary f12"><a href="javascript:" style="color: #999;margin-right: 5px;">{{pickUpCode}}</a><i class="icon iconfont icon-orc"></i></div>
        </div>
        <div class="weui-cell" >
            <div class="weui-cell__bd" >
                <p class="f12">提货时间</p>
            </div>
            <div class="weui-cell__ft weui-cell_primary f12">{{deliveryDate}}</div>
        </div>
        {{/compare}}
    </div>

    <div style="background:#fff">
        <div class="weui-cell" style="padding:5% 2%;">
            <div class="weui-cell__bd">
                <p class="f12">
                  送货地址:<span class="orange">{{consignee}}</span>,&nbsp;<span id="fullName">{{areaName}}</span>,&nbsp;<span>{{address}}</span>,&nbsp;
                    <a href="javascript:"><span class="orange">{{phone}}</span></a>
                </p>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__bd">
                {{#compare memo '!=' null}}
                <p class="f12" style="margin-bottom:5px">买家留言:<span>{{memo}}</span></p>
                {{/compare}}
                {{#compare memo '==' null}}
                <p class="f12" style="margin-bottom:5px">买家留言:<span>暂无</span></p>
                {{/compare}}
                <a href="../product/product-details.html?id={{tenantId}}#shop-guide" class="clr-orange-border" >联系导购</a>
            </div>
        </div>
    </div>

    <div class="weui-cells status mainback">
        <div class="weui-cell">
            <div class="weui-cell__bd">
                <p class="f14">商品信息</p>
            </div>
        </div>
    </div>

    <div class="orderd" style="background:#fff">
        <div class="weui-cells Details" style="margin-right: 0">
            <a class="weui-cell" href="../tenant/tenant-home.html?id={{tenantId}}">
                <div class="weui-cell__hd"><i class="icon iconfont icon-store-02" style="margin-right: 5px"></i></div>
                <div class="weui-cell__bd Ftitle">{{tenantName}}</div>
                <div class="weui-cell__ft state f12">{{finalOrderStatus.desc}}</div>
            </a>
            {{#each orderItems}}
            <a class="weui-cell shangpin" data-id={{id}} id="{{productId}}" href="javascript:;">
                <div class="weui-cell__hd  product_img"><img src="{{thumbnail}}"></div>
                <div class="weui-cell__bd product-txt">
                    <p class="Ftitle">{{fullName}}</p>
                    <p class="price f14">￥{{price}}</p>

                    {{#if promotions}}
                        {{#with promotions}}
                            <div class="border-top Fauxiliary">
                                {{#each this}}
                                <div class="f12"><i class="iconfont icon-{{type}} tenant_i fl"></i>{{name}}</div>
                                {{/each}}
                            </div>
                        {{/with}}
                    {{/if}}

                </div>
                <div class="weui-cell__ft qty f14">x{{quantity}}</div>
            </a>
            {{/each}}
            {{#if giftItems}}
            {{#each giftItems}}
            <a class="weui-cell shangpin" data-id={{id}} id="{{productId}}" href="javascript:;">
                <div class="weui-cell__hd  product_img"><img src="{{thumbnail}}"></div>
                <div class="weui-cell__bd product-txt">
                    <p class="Ftitle">{{fullName}}<i class="icon iconfont icon-zeng" style="color:#ffa829"></i></p>
                    <p class="price f14">￥{{price}}</p>
                </div>
                <div class="weui-cell__ft qty f14">x{{quantity}}</div>
            </a>
            {{/each}}
            {{/if}}
            <div class="weui-cell">
                <div class="weui-cell__bd weui-cell_primary f14">
                    <p>商品金额</p>
                    {{#compare discount '!=' '0'}}<p><i class="icon iconfont icon-minus" style="color: #ff6e08;font-size: 20px;vertical-align: middle;padding-right: 5px;"></i>挑货立减</p>{{/compare}}
                    {{#compare couponDiscount '!=' '0'}}<p><i class="icon iconfont icon-juan" style="color:#c285e3;font-size: 20px;vertical-align: middle;padding-right: 5px;"></i>店铺代金券</p>{{/compare}}
                    {{#compare promotionDiscount '!=' '0'}}<p><i class="icon iconfont icon-zhe" style="color: #ff625a;font-size: 20px;vertical-align: middle;padding-right: 5px;"></i>优惠金额</p>{{/compare}}
                    {{#compare freight '!=' '0'}}<p>运费</p>{{/compare}}
                </div>
                <div class="weui-cell__ft f14">
                    <p>￥{{productPrice}}</p>
                    {{#compare discount '!=' '0'}}<p>-￥{{discount}}</p>{{/compare}}
                    {{#compare couponDiscount '!=' '0'}}<p>-￥{{couponDiscount}}</p>{{/compare}}
                    {{#compare promotionDiscount '!=' '0'}}<p >-￥{{promotionDiscount}}</p>{{/compare}}
                    {{#compare freight '!=' '0'}}<p>￥{{freight}}</p>{{/compare}}
                </div>
            </div>


        </div>
        <div class="weui-cells" style="margin:10px 0;background:#ececec;padding:5px 0 ">
            <div class="weui-cell">
                <div class="weui-cell__hd f14">
                    <p id="tiaoicon">挑</p>
                </div>
                <div class="weui-cell__bd f14">
                    <p>获得积分</p>
                </div>
                <div class="weui-cell__ft f14 ">
                    <p style="color: #000">{{point}}分</p>
                </div>
            </div>
        </div>

        <div class="f16" style="text-align: right; padding-right:2%">
            实付款<span class="orange" style="margin-left: 10px;">￥{{amount}}</span>
        </div>

        {{#if finalOrderStatus}}
        <div class="btns" order-id="{{id}}" style="border:0">
            {{#compare finalOrderStatus.status '==' 'unconfirmed'}}
            <a href="javascript:;" class="btn-gray closeod">取消订单</a>
            {{/compare}}
            {{#compare finalOrderStatus.status '==' 'waitPay'}}
            <a href="javascript:;" class="btn-gray closeod">取消订单</a>
            <a href="javascript:;" class="btn-actvie payod">立即支付</a>
            {{/compare}}
            {{#compare finalOrderStatus.status '==' 'waitShipping'}}
            <a href="javascript:;" class="btn-gray backod">退货申请</a>
            <a href="javascript:;" class="btn-actvie alertod">提醒商家发货</a>
            {{/compare}}
            {{#compare finalOrderStatus.status '==' 'sign'}}
            <a href="javascript:;" class="btn-gray backod">退货</a>
            <a href="https://m.kuaidi100.com/result.jsp?nu={{trackingNo}}" class="btn-gray">查看物流</a>
            <a href="javascript:;" class="btn-actvie signod">立即签收</a>
            {{/compare}}
            {{#compare finalOrderStatus.status '==' 'toReview'}}
            <a  data-id="{{id}}" class="btn-actvie reviewod">立即评价</a>
            {{/compare}}
            {{#compare finalOrderStatus.status '==' 'waitReturn'}}
            <a href="javascript:;" class="btn-gray getmoneyod">提醒商家退款</a>
            {{/compare}}
        </div>
        {{/if}}
    </div>

    <div class="kong"></div>
</div>
<!-- orderdetail end -->
<script>
    $(function(){
        $('.col-2').last().find('.line').remove();
        //取消订单
        $('.closeod').on('click',function () {
            var od_id;
            od_id=$(this).parent().attr('order-id');
            dialog.query("您确认取消该订单吗？",function(){
                var or=new order(function(data){
                    console.log(data);
                    setTimeout(function () {
                        pageManager.back();
                    },1000);
                });
                or.refund({id:od_id})
            });
        });


        $('.reviewod').on('click',function () {
            var ev=$(this).parent().attr('order-id');
            location.href=location.origin+'/weixin/member/member-home.html?id='+ev+'#evaluate';
        })


        //提醒卖家发货
        $('.alertod').on('click',function () {
            var od_id=$(this).parent().attr('order-id');
            var or=new order(function(data){
                console.log(data);
                dialog.show("提醒成功");
            });
            or.remind({id:od_id})
        });

        //提醒卖家退款
        $('.getmoneyod').on('click',function () {
            var od_id=$(this).parent().attr('order-id');
            var or=new order(function(data){
                console.log(data);
                dialog.show("提醒成功");
            });
            or.remind({id:od_id})
        });


        //签收订单
        $('.signod').on('click',function () {
            var od_id;
            od_id=$(this).parent().attr('order-id');
            dialog.query("您确认签收该订单吗？",function () {
                var or=new order(function(data){
                    console.log(data);
                    toast.show("签收成功");
                    setTimeout(function () {
//                       pageManager.back();
                        location.href=location.origin+'/weixin/member/member-home.html?id='+od_id+'#evaluate';
                    },1000);
                });
                or.confirm({id:od_id})
            })

        });
        //申请退货
        $('.backod').on('click',function () {
            var od_id;
            od_id=$(this).parent().attr('order-id');
            dialog.query("您确认申请退货吗？",function () {
                var or=new order(function(data){
                    console.log(data);
                    toast.show("申请成功");
                    setTimeout(function () {
                        pageManager.back();
                    },1000);
                });
                or.return({id:od_id});
            })
        });

        //立即支付订单
        $('.payod').on('click',function () {
            var order_id;
            order_id=$(this).parent().attr('order-id');
            var od=new order(function(data){
                location.href=location.origin+'/weixin/payment/orderPayment.html?sn='+data;
            });
            od.tradePayment({id:order_id});
        });

        
        //查看物流
        $('.logistics').on('click',function () {
            var lssn=$('#trackingNo').html();
            location.href=location.origin+'/weixin/member/logistics.html?sn='+lssn;
        });


        $('#Gcode .icon-orc').on('click',function () {
            $("#iosMask").fadeIn();
            $('.getcode').show();
        });
    })
</script>
</script>
<!--我的订单评价页-->
<script type="text/html" id="tpl_evaluateOrders">
<!-- evaluateOrders-->
<div class="evaluateorder orderd">
    {{#each orderItems}}
    <div class="weui-cells cl">
        <div class="weui-cell">
            <a href="javascript:;">
                <img src="{{thumbnail}}" alt="icon">
            </a>
            <div class="weui-cell__bd " itemid="{{orderItemId}}">
                <p class="f12" style="margin-left: 10px">{{name}}</p>
                {{#if isReview}}
                <p class="f12 toproduct clr-LightGray-border"><i class="icon iconfont icon-editor-01 f12"></i>已评价</p>
                {{else}}
                <p class="f12 toproduct clr-orange-border"><i class="icon iconfont icon-editor-01 f12"></i>评价晒单</p>
                {{/if}}
            </div>
        </div>
    </div>

    <div class="reviewproduct">
        <div class="weui-cells product">
            <div class='starCon weui-cell' id="evaluateproduct{{orderItemId}}">
                <div class='starTitle weui-cell__bd f12'>宝贝评分：</div>
                <div class="weui-cell__ft">
                    <i class="iconfont icon-s-star f14"></i>
                    <i class="iconfont icon-s-star f14"></i>
                    <i class="iconfont icon-s-star f14"></i>
                    <i class="iconfont icon-s-star f14"></i>
                    <i class="iconfont icon-s-star f14"></i>
                </div>
                <input type='hidden' value='5' id='product' />
            </div>
        </div>
        <form id="headForm" action="javascript:;" method="post" enctype="multipart/form-data">
            <div class="weui-cells weui-cells_form">
                <div class="weui-cell">
                    <div class="weui-cell__bd weui-cell_primary">
                        <textarea id="content" name="content" class="weui-textarea f12" placeholder="写下购物体会和使用感受来帮助其他小伙伴~评价大于20元的商品超过10个字就有机会获得挑豆！，" rows="3" id="textarea" maxlength="200"></textarea>
                        <div class="weui-textarea-counter f12"><span id="text_length">0</span>/200</div>
                    </div>
                </div>
            </div>
        </form>

        <!--上传图片-->
        <div class="weui-gallery" id="gallery">
            <span class="weui-gallery__img" id="galleryImg"></span>
            <div class="weui-gallery__opr">
                <a href="javascript:" class="weui-gallery__del">
                    <i class="weui-icon-delete weui-icon_gallery-delete"></i>
                </a>
            </div>
        </div>
        <div class="weui-cells weui-cells_form" style="padding:10px">
            <div class="weui-cell" >
                <div class="weui-cell__bd">
                    <div class="weui-uploader">
                        <div class="weui-uploader__hd">
                            <p class="weui-uploader__title f12">买家秀秀</p>
                        </div>
                        <div class="weui-uploader__bd">
                            <ul class="weui-uploader__files" id="uploaderFiles{{orderItemId}}">
                            </ul>
                            <form class="weui-uploader__input-box" id="updateForm{{orderItemId}}" enctype ="multipart/form-data">
                                <input id="uploaderInput{{orderItemId}}" class="weui-uploader__input" type="text" accept="image/*" multiple />
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class=" weui-cells_checkbox">
                <label class="weui-check__label">
                    <p class="checkboxs" style="float:left">
                        <input type="checkbox" class="weui-check" name="checkbox1" id="isAnonym">
                        <i class="weui-icon-checked"></i>
                    </p>
                    <p class="f12" style="float:left">匿名评价</p>
                </label>
                <label class="weui-check__label">
                    <p class="checkboxs" style="float:left">
                        <input type="checkbox" class="weui-check" name="checkbox2">
                        <i class="weui-icon-checked"></i>
                    </p>
                    <p class="f12" style="float:left">同步发布到社区</p>
                </label>
            </div>
        </div>
        <div class="weui-btn-area" oItemId="{{orderItemId}}">
            <a class="weui-btn btn-default sendproduct" href="javascript:" orderItemId="{{orderItemId}}">发表评论</a>
        </div>
    </div>
    {{/each}}
    <div class="weui-cells">
        <div class='weui-cell'>
            <i class="icon iconfont icon-s-heart-01" style="color:red;"></i>
            <div class='weui-cell__bd f12' style="margin-left: 5px">店铺服务评价</div>
            <div class='weui-cell__ft f12'>满意请给5星哦</div>
        </div>
        <div class='starCon weui-cell' id="evaluatetenant">
            <div class='starTitle weui-cell__bd f12'>店铺综合评分：</div>
            <div class="weui-cell__ft">
                <i class="iconfont icon-s-star f14"></i>
                <i class="iconfont icon-s-star f14"></i>
                <i class="iconfont icon-s-star f14"></i>
                <i class="iconfont icon-s-star f14"></i>
                <i class="iconfont icon-s-star f14"></i>
            </div>
            <input type='hidden' value='5' id='tenant' />
        </div>

        {{#if guide}}
        <div class='starCon weui-cell' id="evaluateguide">
            <div class="weui-cell__hd">
                <img src="../images/static/feedbackph.png" alt="" style="width:30px;margin-right:5px;">
            </div>
            <div class="weui-cell__bd f12">
                <p class="guidename">导购名字</p>
                <p class="f12">导购服务质量</p>
            </div>
            <div class="weui-cell__ft">
                <i class="iconfont icon-s-star f14"></i>
                <i class="iconfont icon-s-star f14"></i>
                <i class="iconfont icon-s-star f14"></i>
                <i class="iconfont icon-s-star f14"></i>
                <i class="iconfont icon-s-star f14"></i>
            </div>
            <input type='hidden' value='5' id='guide' />
        </div>
        {{/if}}

        {{#with tenant}}
        {{#if score}}
        <p class="f12 totenant clr-LightGray-border"><i class="icon iconfont icon-editor-01 f12"></i>已评价</p>
        {{else}}
        <p class="f12 totenant clr-orange-border"><i class="icon iconfont icon-editor-01 f12"></i>发表评价</p>
        {{/if}}
        {{/with}}
    </div>
</div>

<script>
    $(function () {
        //店铺评价与导购评价
        function star(starId){
            var oStar = document.getElementById(starId);
            var aLi = oStar.getElementsByTagName("i");
            var oP = oStar.getElementsByTagName("input")[0];
            var i = iScore = iStar = 0;
            for (i = 1; i <= aLi.length; i++){
                aLi[i - 1].index = i;
                //点击后进行评分处理
                aLi[i - 1].onclick = function (){
                    iStar = this.index;
                    fnPoint(iStar);
                    oP.value=iStar;
                }
            }
            //评分处理
            var fnPoint=function(iArg){
                //分数赋值
                iScore = iArg || iStar;
                for (i = 0; i < aLi.length; i++) aLi[i].className = i < iScore ? "iconfont icon-s-star f14" : "iconfont icon-l-star f14";
            };
            fnPoint(5)
        }
        star("evaluatetenant"); //调用店铺评价星星的方法
        if(document.getElementById('evaluateguide')){
            star("evaluateguide");  //调用导购星星评分的方法
        }



        //星星评分功能以及图片上传预览功能
        //点击评价晒单后弹出评论框
        var tmpl = '<li class="weui-uploader__file" style="background-image:url(#url#)"></li>';
        $(".toproduct").click(function(){
            var oitemId=$(this).parent().attr("itemid");//当前商品项Id
            ss("uploaderInput"+oitemId,"uploaderFiles"+oitemId); //input的id  ul的id

            //宝贝星星评分方法
            function starComm(starId){
                var oStar = document.getElementById(starId);
                var aLi = oStar.getElementsByTagName("i");
                var oP = oStar.getElementsByTagName("input")[0];
                var i = iScore = iStar = 0;
                for (i = 1; i <= aLi.length; i++){
                    aLi[i - 1].index = i;
                    //点击后进行评分处理
                    aLi[i - 1].onclick = function (){
                        iStar = this.index;
                        fnPoint(iStar);
                        oP.value=iStar;
                    }
                }
                //评分处理
                var fnPoint=function(iArg){
                    //分数赋值
                    iScore = iArg || iStar;
                    for (i = 0; i < aLi.length; i++) aLi[i].className = i < iScore ? "iconfont icon-s-star f14" : "iconfont icon-l-star f14";
                };
                fnPoint(5)
            }
            $(this).parent().parent().parent().next('div').fadeToggle();
            var idid='evaluateproduct'+oitemId;
            starComm(idid);      //调用星星评分方法


            //本地上传图片并预览
            function ss(a,b){
                var $uploaderInput = $("#"+a);
                var $uploaderFiles = $("#"+b);
                $uploaderInput.click(function () {
                    var index=$(this).siblings().length;
                    $(this).parent().append('<input name="images['+index+'].file" class="weui-uploader__input uploaderInput" style="display: none;" type="file" accept="image/*" multiple />');
                    $(this).parent().find("input").last().trigger("click");
                });

                //点击图片展示大图，再次点击关闭大图
                $uploaderFiles.on("click", "li", function(){
                    var index=$(this).index();  //获取当前图片的下标
                    var gallery=$(this).parent().parent().parent().parent().parent().parent().prev('div');
                    var galleryImg=$(this).parent().parent().parent().parent().parent().parent().prev('div').find('span');
                    var delimg=$(this).parent().parent().parent().parent().parent().parent().prev('div').find('a');

                    //显示大图预览
                    galleryImg.attr("style", this.getAttribute("style"));
                    gallery.fadeIn(100);

                    //关闭大图预览
                    gallery.click(function () {
                        $(this).fadeOut(100);
                    });

                    //买家删除当前照片
                    delimg.click(function (){
                        $(this).parent().parent().next('div').find('ul li').eq(index).remove();
                    })
                });
            }
        });

        $(document).on("change",".uploaderInput",function (e) {
            var src, url = window.URL || window.webkitURL || window.mozURL, files = e.target.files;
            for (var i = 0, len = files.length; i < len; ++i) {
                var file = files[i];
                if (url) {
                    src = url.createObjectURL(file);
                } else {
                    src = e.target.result;
                }
                $(this).parent().prev('ul').append($(tmpl.replace('#url#', src)));
            }
        });

        //商品评论提交
        $('.sendproduct').click(function(){
            var $this=$(this);
            var orderItemId=$this.attr("orderItemId");                                                   //商品项id
            var content=$this.parent().prev('div').prev('div').prev('form').find('textarea').val();     //宝贝评论内容
            var score=parseInt($this.parent().prev().prev().prev().prev('div').find('input').val());    //商品评分
            var flag="product";                                                                         //商品评论
            var isAnonym;                                                                               //是否匿名
            if($('#isAnonym').prop('checked')){
                isAnonym=true;
            }else{
                isAnonym=false;
            }
            if(content==''){   //当用户不输入评论内容时，默认内容为好评
                content='好评！'
            };
                var re=new review(function(data){
                    console.log(data);
                    setTimeout(function (){
                        toast.show('你的评价提交成功');
                    },500);
                    $this.parent().parent().prev('div').find('.toproduct').css('color','gray').css('border','1px solid gray').html('已评价');
                    $this.parent().parent().css('display','none');
                });
                var jsons=new FormData($("#updateForm"+orderItemId)[0]);
                jsons.append("orderItemId",orderItemId);
                jsons.append("content",content);
                jsons.append("score",score);
                jsons.append("flag",flag);
                jsons.append("isAnonym",isAnonym);
                console.log(jsons);
                re.submit(jsons);
        });


        //订单评论
        $(".totenant").click(function(){
            var $this=$(this);
            var tradeId=pageManager.GetQueryString("id");      //子订单id
            var point_tenant=parseInt($('#tenant').val());     //商家评分
            var point_guide=parseInt($('#guide').val());       //导购评分
            console.log(!isNaN(point_guide));
            var r=new review(function(data){
                console.log(data)
                setTimeout(function (){
                    toast.show('您的评价提交成功');
                    $this.html('已评价');
                    $this.addClass('clr-LightGray-border');
                },500);
            });
            var options={
                tradeId:tradeId,
                score:point_tenant,
                flag:"trade"
            };
            if(!isNaN(point_guide)){
                options.assistant=point_guide;
            }
            r.submit1(options);
        });

        //检测文本域的字数
        $("#textarea").keyup(function() {
            $("#text_length").text($("#textarea").val().length);
        });
    })
</script>

<!-- evaluateOrders end -->


</script>

<!--订单消息账单消息系统消息-->
<script type="text/html" id="tpl_orderMessage">
{{#each this}}
<div class="weui-cells" >
    <div class="weui-cell">
        <div class="weui-cell__hd">
            <p class="f12">{{title}}</p>
            {{#if image}}
            <img src="{{image}}" alt="">
            {{else}}
            <img src="../images/placeholder/product.png" alt="">
            {{/if}}
        </div>
        <div class="weui-cell__bd f10">
            {{content}}
        </div>
        <div class="weui-cell__ft">
        </div>
    </div>
    <div class="weui-cell weui-cell_access" onclick="location.href='member-home.html?id={{sid}}#orderDetail' ">
        <div>
            <p class="f10" ifread="{{read}}">{{create_date}}</p>
        </div>
        <div class="weui-cell__bd">

        </div>
        <div class="weui-cell__ft f10">
            查看详情
        </div>
    </div>
</div>
{{/each}}
</script>
<script type="text/html" id="tpl_billMessage">
{{#each this}}
<div class="weui-cells">
    <div class="weui-cell">
        <div class="weui-cell__hd">
            <p class="f12">{{title}}</p>
            {{#if image}}
            <img src="{{image}}" alt="">
            {{else}}
            <img src="../images/placeholder/product.png" alt="">
            {{/if}}
        </div>
        <div class="weui-cell__bd f10">
            {{content}}
        </div>
        <div class="weui-cell__ft">
        </div>
    </div>
    <div class="weui-cell weui-cell_access gobillms">
        <div>
            <p class="f10" ifread="{{read}}">{{create_date}}</p>
        </div>
        <div class="weui-cell__bd">
        </div>
        <div class="weui-cell__ft f10">
            查看详情
        </div>
    </div>
</div>
{{/each}}
<script>
    $(function () {
        $('.gobillms').on('click',function () {
            location.href=location.origin+'/weixin/member/member-home.html#bill-list';
            location.reload();
        })
    })
</script>
</script>
<script type="text/html" id="tpl_systemMessage">
{{#each this}}

<div class="weui-cells">
    <div class="weui-cell">
        <div class="weui-cell__hd">
            <p class="f12">{{title}}</p>
            {{#if image}}
            <img src="{{image}}" alt="">
            {{else}}
            <img src="../images/placeholder/product.png" alt="">
            {{/if}}
        </div>
        <div class="weui-cell__bd f10">
            {{content}}
        </div>
        <div class="weui-cell__ft">
        </div>
    </div>
    <div class="weui-cell">
        <div><p class="f10" ifread="{{read}}">{{create_date}}</p></div>
        <div class="weui-cell__bd">
        </div>
        <div class="weui-cell__ft f10">
        </div>
    </div>
</div>
{{/each}}
</script>



<script src="/weixin/js/wap.min.js"></script>


<script type="text/javascript">
    $(function () {
        pageManager.show("member-index");
    });
</script>


</body>
</html>


